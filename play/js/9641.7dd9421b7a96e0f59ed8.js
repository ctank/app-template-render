"use strict";(self.webpackChunkapp_template_builder=self.webpackChunkapp_template_builder||[]).push([[9641],{90621:function(e,t,i){i.d(t,{J:function(){return T}});var r=i(13484),s=i(20996),n=i(94880),o=i(38431),d=i(5603),c=i(8964),a=i(50038),l=i(12139),h=i(26386),g=i(80793),u=i(71177),f=i(70499),_=i(44333),v=i(47679),p=i(67502),w=i(97968),m=i(75295),b=i(32498),R=i(13385),y=function(e,t,i,r){var s,n=arguments.length,o=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,r);else for(var d=e.length-1;d>=0;d--)(s=e[d])&&(o=(n<3?s(o):n>3?s(t,i,o):s(t,i))||o);return n>3&&o&&Object.defineProperty(t,i,o),o},S=function(e,t){return function(i,r){t(i,r,e)}},P=function(e,t,i,r){return new(i||(i=Promise))((function(s,n){function o(e){try{c(r.next(e))}catch(e){n(e)}}function d(e){try{c(r.throw(e))}catch(e){n(e)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,d)}c((r=r.apply(e,t||[])).next())}))};const C=new f.uy("referenceSearchVisible",!1,h.NC("referenceSearchVisible","Whether reference peek is visible, like 'Peek References' or 'Peek Definition'"));let T=class e{constructor(e,t,i,r,s,n,d,c){this._defaultTreeKeyboardSupport=e,this._editor=t,this._editorService=r,this._notificationService=s,this._instantiationService=n,this._storageService=d,this._configurationService=c,this._disposables=new o.SL,this._requestIdPool=0,this._ignoreModelChangeEvent=!1,this._referenceSearchVisible=C.bindTo(i)}static get(t){return t.getContribution(e.ID)}dispose(){var e,t;this._referenceSearchVisible.reset(),this._disposables.dispose(),null===(e=this._widget)||void 0===e||e.dispose(),null===(t=this._model)||void 0===t||t.dispose(),this._widget=void 0,this._model=void 0}toggleWidget(e,t,i){let r;if(this._widget&&(r=this._widget.position),this.closeWidget(),r&&e.containsPosition(r))return;this._peekMode=i,this._referenceSearchVisible.set(!0),this._disposables.add(this._editor.onDidChangeModelLanguage((()=>{this.closeWidget()}))),this._disposables.add(this._editor.onDidChangeModel((()=>{this._ignoreModelChangeEvent||this.closeWidget()})));const s="peekViewLayout",n=R.J.fromJSON(this._storageService.get(s,0,"{}"));this._widget=this._instantiationService.createInstance(R.d,this._editor,this._defaultTreeKeyboardSupport,n),this._widget.setTitle(h.NC("labelLoading","Loading...")),this._widget.show(e),this._disposables.add(this._widget.onDidClose((()=>{t.cancel(),this._widget&&(this._storageService.store(s,JSON.stringify(this._widget.layoutData),0,1),this._widget=void 0),this.closeWidget()}))),this._disposables.add(this._widget.onDidSelectReference((e=>{const{element:t,kind:r}=e;if(t)switch(r){case"open":"editor"===e.source&&this._configurationService.getValue("editor.stablePeek")||this.openReference(t,!1,!1);break;case"side":this.openReference(t,!0,!1);break;case"goto":i?this._gotoReference(t):this.openReference(t,!1,!0)}})));const o=++this._requestIdPool;t.then((t=>{var i;if(o===this._requestIdPool&&this._widget)return null===(i=this._model)||void 0===i||i.dispose(),this._model=t,this._widget.setModel(this._model).then((()=>{if(this._widget&&this._model&&this._editor.hasModel()){this._model.isEmpty?this._widget.setMetaTitle(""):this._widget.setMetaTitle(h.NC("metaTitle.N","{0} ({1})",this._model.title,this._model.references.length));const t=this._editor.getModel().uri,i=new c.L(e.startLineNumber,e.startColumn),r=this._model.nearestReference(t,i);if(r)return this._widget.setSelection(r).then((()=>{this._widget&&"editor"===this._editor.getOption(79)&&this._widget.focusOnPreviewEditor()}))}}));t.dispose()}),(e=>{this._notificationService.error(e)}))}changeFocusBetweenPreviewAndReferences(){this._widget&&(this._widget.isPreviewEditorFocused()?this._widget.focusOnReferenceTree():this._widget.focusOnPreviewEditor())}goToNextOrPreviousReference(e){return P(this,void 0,void 0,(function*(){if(!this._editor.hasModel()||!this._model||!this._widget)return;const t=this._widget.position;if(!t)return;const i=this._model.nearestReference(this._editor.getModel().uri,t);if(!i)return;const r=this._model.nextOrPreviousReference(i,e),s=this._editor.hasTextFocus(),n=this._widget.isPreviewEditorFocused();yield this._widget.setSelection(r),yield this._gotoReference(r),s?this._editor.focus():this._widget&&n&&this._widget.focusOnPreviewEditor()}))}revealReference(e){return P(this,void 0,void 0,(function*(){this._editor.hasModel()&&this._model&&this._widget&&(yield this._widget.revealReference(e))}))}closeWidget(e=!0){var t,i;null===(t=this._widget)||void 0===t||t.dispose(),null===(i=this._model)||void 0===i||i.dispose(),this._referenceSearchVisible.reset(),this._disposables.clear(),this._widget=void 0,this._model=void 0,e&&this._editor.focus(),this._requestIdPool+=1}_gotoReference(t){this._widget&&this._widget.hide(),this._ignoreModelChangeEvent=!0;const i=a.e.lift(t.range).collapseToStart();return this._editorService.openCodeEditor({resource:t.uri,options:{selection:i,selectionSource:"code.jump"}},this._editor).then((t=>{var s;if(this._ignoreModelChangeEvent=!1,t&&this._widget)if(this._editor===t)this._widget.show(i),this._widget.focusOnReferenceTree();else{const n=e.get(t),o=this._model.clone();this.closeWidget(),t.focus(),null==n||n.toggleWidget(i,(0,r.PG)((e=>Promise.resolve(o))),null!==(s=this._peekMode)&&void 0!==s&&s)}else this.closeWidget()}),(e=>{this._ignoreModelChangeEvent=!1,(0,s.dL)(e)}))}openReference(e,t,i){t||this.closeWidget();const{uri:r,range:s}=e;this._editorService.openCodeEditor({resource:r,options:{selection:s,selectionSource:"code.jump",pinned:i}},this._editor,t)}};function E(e,t){const i=(0,l.rc)(e);if(!i)return;const r=T.get(i);r&&t(r)}T.ID="editor.contrib.referencesController",T=y([S(2,f.i6),S(3,d.$),S(4,w.lT),S(5,_.TG),S(6,m.Uy),S(7,u.Ui)],T),v.W.registerCommandAndKeybindingRule({id:"togglePeekWidgetFocus",weight:100,primary:(0,n.gx)(2089,60),when:f.Ao.or(C,l.Jy.inPeekEditor),handler(e){E(e,(e=>{e.changeFocusBetweenPreviewAndReferences()}))}}),v.W.registerCommandAndKeybindingRule({id:"goToNextReference",weight:90,primary:62,secondary:[70],when:f.Ao.or(C,l.Jy.inPeekEditor),handler(e){E(e,(e=>{e.goToNextOrPreviousReference(!0)}))}}),v.W.registerCommandAndKeybindingRule({id:"goToPreviousReference",weight:90,primary:1086,secondary:[1094],when:f.Ao.or(C,l.Jy.inPeekEditor),handler(e){E(e,(e=>{e.goToNextOrPreviousReference(!1)}))}}),g.P0.registerCommandAlias("goToNextReferenceFromEmbeddedEditor","goToNextReference"),g.P0.registerCommandAlias("goToPreviousReferenceFromEmbeddedEditor","goToPreviousReference"),g.P0.registerCommandAlias("closeReferenceSearchEditor","closeReferenceSearch"),g.P0.registerCommand("closeReferenceSearch",(e=>E(e,(e=>e.closeWidget())))),v.W.registerKeybindingRule({id:"closeReferenceSearch",weight:-1,primary:9,secondary:[1033],when:f.Ao.and(l.Jy.inPeekEditor,f.Ao.not("config.editor.stablePeek"))}),v.W.registerKeybindingRule({id:"closeReferenceSearch",weight:250,primary:9,secondary:[1033],when:f.Ao.and(C,f.Ao.not("config.editor.stablePeek"))}),v.W.registerCommandAndKeybindingRule({id:"revealReference",weight:200,primary:3,mac:{primary:3,secondary:[2066]},when:f.Ao.and(C,p.CQ,p.PS.negate(),p.uJ.negate()),handler(e){var t;const i=null===(t=e.get(p.Lw).lastFocusedList)||void 0===t?void 0:t.getFocus();Array.isArray(i)&&i[0]instanceof b.WX&&E(e,(e=>e.revealReference(i[0])))}}),v.W.registerCommandAndKeybindingRule({id:"openReferenceToSide",weight:100,primary:2051,mac:{primary:259},when:f.Ao.and(C,p.CQ,p.PS.negate(),p.uJ.negate()),handler(e){var t;const i=null===(t=e.get(p.Lw).lastFocusedList)||void 0===t?void 0:t.getFocus();Array.isArray(i)&&i[0]instanceof b.WX&&E(e,(e=>e.openReference(i[0],!0,!0)))}}),g.P0.registerCommand("openReference",(e=>{var t;const i=null===(t=e.get(p.Lw).lastFocusedList)||void 0===t?void 0:t.getFocus();Array.isArray(i)&&i[0]instanceof b.WX&&E(e,(e=>e.openReference(i[0],!1,!0)))}))},38623:function(e,t,i){i.d(t,{EZ:function(){return S},QC:function(){return A},U$:function(){return C},bu:function(){return R},o2:function(){return b},vn:function(){return y},vr:function(){return E}});var r=i(34441),s=i(64404),n=i(86357),o=i(20588),d=i(4538),c=i(38431),a=i(6227),l=i(91223),h=i(26386),g=i(44333),u=i(55495),f=i(18680),_=i(83003),v=i(58566),p=i(32498),w=function(e,t,i,r){var s,n=arguments.length,o=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,r);else for(var d=e.length-1;d>=0;d--)(s=e[d])&&(o=(n<3?s(o):n>3?s(t,i,o):s(t,i))||o);return n>3&&o&&Object.defineProperty(t,i,o),o},m=function(e,t){return function(i,r){t(i,r,e)}};let b=class{constructor(e){this._resolverService=e}hasChildren(e){return e instanceof p.oQ||e instanceof p.F2}getChildren(e){if(e instanceof p.oQ)return e.groups;if(e instanceof p.F2)return e.resolve(this._resolverService).then((e=>e.children));throw new Error("bad tree")}};b=w([m(0,l.S)],b);class R{getHeight(){return 23}getTemplateId(e){return e instanceof p.F2?C.id:E.id}}let y=class{constructor(e){this._keybindingService=e}getKeyboardNavigationLabel(e){var t;if(e instanceof p.WX){const i=null===(t=e.parent.getPreview(e))||void 0===t?void 0:t.preview(e.range);if(i)return i.value}return(0,a.EZ)(e.uri)}};y=w([m(0,u.d)],y);class S{getId(e){return e instanceof p.WX?e.id:e.uri}}let P=class extends c.JT{constructor(e,t,i){super(),this._labelService=t;const n=document.createElement("div");n.classList.add("reference-file"),this.file=this._register(new o.g(n,{supportHighlights:!0})),this.badge=new s.Z(r.R3(n,r.$(".count"))),this._register((0,_.WZ)(this.badge,i)),e.appendChild(n)}set(e,t){const i=(0,a.XX)(e.uri);this.file.setLabel(this._labelService.getUriBasenameLabel(e.uri),this._labelService.getUriLabel(i,{relative:!0}),{title:this._labelService.getUriLabel(e.uri),matches:t});const r=e.children.length;this.badge.setCount(r),r>1?this.badge.setTitleFormat((0,h.NC)("referencesCount","{0} references",r)):this.badge.setTitleFormat((0,h.NC)("referenceCount","{0} reference",r))}};P=w([m(1,f.e),m(2,v.XE)],P);let C=class e{constructor(t){this._instantiationService=t,this.templateId=e.id}renderTemplate(e){return this._instantiationService.createInstance(P,e)}renderElement(e,t,i){i.set(e.element,(0,d.mB)(e.filterData))}disposeTemplate(e){e.dispose()}};C.id="FileReferencesRenderer",C=w([m(0,g.TG)],C);class T{constructor(e){this.label=new n.q(e)}set(e,t){var i;const r=null===(i=e.parent.getPreview(e))||void 0===i?void 0:i.preview(e.range);if(r&&r.value){const{value:e,highlight:i}=r;t&&!d.CL.isDefault(t)?(this.label.element.classList.toggle("referenceMatch",!1),this.label.set(e,(0,d.mB)(t))):(this.label.element.classList.toggle("referenceMatch",!0),this.label.set(e,[i]))}else this.label.set(`${(0,a.EZ)(e.uri)}:${e.range.startLineNumber+1}:${e.range.startColumn+1}`)}}class E{constructor(){this.templateId=E.id}renderTemplate(e){return new T(e)}renderElement(e,t,i){i.set(e.element,e.filterData)}disposeTemplate(){}}E.id="OneReferenceRenderer";class A{getWidgetAriaLabel(){return(0,h.NC)("treeAriaLabel","References")}getAriaLabel(e){return e.ariaMessage}}}}]);