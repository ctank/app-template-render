(self.webpackChunkapp_template_builder=self.webpackChunkapp_template_builder||[]).push([[334],{7399:function(t,e,n){"use strict";n.d(e,{s:function(){return r}});n(77950),n(85940);var o=n(81850),i=n(27875),r={name:"FormComponentBase",components:{},inject:["onChange","onGetValue","onEvent"],props:{id:{type:String,default:function(){return""}},type:{type:String,default:function(){return""}},extras:{type:Object,default:function(){return{}}},placeholder:{type:String,default:function(){return"请输入"}},rules:{type:Array,default:function(){return[]}},fieldPath:{type:String,default:function(){return""}},componentMap:{type:Object,default:function(){return{}}},subFormComponents:{type:Array,default:function(){return[]}},formData:{type:Object,default:function(){return{}}},disabled:{type:Boolean,default:function(){return!1}},tempVal:{type:Boolean,default:function(){return!1}}},data:function(){return{}},computed:{value:{get:function(){var t="";return this.formData&&this.fieldPath&&(t=(0,o.a)(this.formData,this.fieldPath)),t},set:function(t){this.tempVal?this.$emit("tempChange",t,this.id):this.onChange(t,this.id)}},validProp:function(){return this.fieldPath.replace(/\//g,".")}},render:function(t,e,n,o,r,a){return(0,i.wg)(),(0,i.iD)("div")}}},62334:function(t,e,n){"use strict";n.r(e),n.d(e,{default:function(){return y}});n(18178),n(77950),n(21850),n(85940),n(32501),n(68995),n(16781),n(39529),n(49228),n(58188),n(74660),n(26936),n(31235),n(1939),n(74083),n(99805);var o=n(27875),i=n(50349),r=n(14825),a=n(7399),l=n(81850),u={name:"Tag",props:{color:{type:String,default:function(){return"#000000"}},hit:{type:Boolean,default:function(){return!1}}},computed:{style:function(){return"color:".concat(this.color,";background-color:").concat(this.hex2Rgba(this.color,.1),";")}},methods:{hex2Rgba:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(/^#([0-9A-Fa-f]{3}|[0-9A-Fa-f]{6})$/.test(t)){var n=t.toLowerCase().replace(/\#/g,"");if(3===n.length){for(var o="",i=0;i<n.length;i++)o+=n.slice(i,i+1).concat(n.slice(i,i+1));n=o}for(var r=[],a=0;a<6;a+=2){var l=n.slice(a,a+2);r.push(parseInt("0x"+l))}return"rgba(".concat(r.join(","),",").concat(e,")")}}},render:function(t,e,n,r,a,l){return(0,o.wg)(),(0,o.iD)("span",{class:"atp-tag",style:(0,i.normalizeStyle)(l.style)},[(0,o.WI)(t.$slots,"default")],4)}},c=n(28879),s=["textBox","textarea","number"],f=["radio","checkBox","select","cascader"],d=["datetime"],p=["imageUpload","fileUpload"],h={excel:["xls","xlsx"],music:["mp3","wav"],pic:["jpg","png","gif"],ppt:["ppt","pptx"],video:["mp4"],word:["doc","docx"],zip:["zip","rar","7z"]},m=(0,o.aZ)({name:"ColumnContent",components:{Tag:u},props:{row:{type:Object,default:function(){return null}},column:{type:Object,default:function(){return null}},componentMap:{type:Object,default:function(){return{}}},isEdit:{type:Boolean,default:function(){return!1}}},computed:{config:function(){var t=this.row[this.columnComponent.fieldPath]||"",e={content:"",type:"text",color:""};if(s.includes(this.column.fieldSet.type))e.content=t;else if(d.includes(this.column.fieldSet.type)){var n,o=(null===(n=this.columnComponent)||void 0===n?void 0:n.extras.format)||"YYYY-MM-DD HH:mm:ss";e.content=c(t).format(o||"YYYY-MM-DD HH:mm:ss")}else if(f.includes(this.column.fieldSet.type)){var i,r=((null===(i=this.column.fieldConfig)||void 0===i?void 0:i.extras.options)||[]).find((function(e){return e.value===t}));r&&(e.content=r.label,r.color&&(e.type="tag",e.color=r.color))}else p.includes(this.column.fieldSet.type)&&(e.type="file",e.content=t,"string"==typeof t?e.content=[{name:t,url:t}]:Array.isArray(t)||(e.content=[]));return e},columnComponent:function(){var t=this.componentMap[this.column.fieldSet.componentId];return t.showTitle=!1,t},getComponentDisplay:function(){var t=!0,e=this.column.fieldConfig;return e&&((t=(0,l.g)(e.extras.showConfig,this.row,this.componentMap))||this.components.some((function(t){return t.fieldPath===e.fieldPath}))||(0,l.s)(this.row,e.fieldPath,"")),t},getComponentDisabled:function(){var t=!1,e=this.column.fieldConfig;return e&&(t=(0,l.g)(e.extras.readonlyConfig,this.row,this.componentMap,t)),t}},methods:{getFileTypeIconSrc:function(t){var e=l.F.default,n=t.name.lastIndexOf(".");if(n>=0){var o=t.name.substr(n+1);if(l.k[o.toLowerCase()])e=l.k[o.toLowerCase()];else for(var i in h)h[i].includes(o)&&(e=l.F[i])}return e},handleValueChange:function(t){var e=this.columnComponent.fieldPath;e&&"[object event]"!==Object.prototype.toString.call(t)&&(this.row[e]=t)}}}),g={key:0},w={key:2},v=["title","src"];m.render=function(t,e,n,r,a,l){var u=(0,o.up)("tag"),c=(0,o.up)("form-component-render");return(0,o.wg)(),(0,o.iD)("div",{class:(0,i.normalizeClass)({"atp-subform__column":!0,"atp-subform__column--click":t.column.clickEvent})},["text"!==t.config.type||t.isEdit?"tag"!==t.config.type||t.isEdit?"file"!==t.config.type||t.isEdit?t.getComponentDisplay?((0,o.wg)(),(0,o.j4)(c,{key:3,formData:t.row,component:t.columnComponent,componentMap:t.componentMap,disabled:t.getComponentDisabled,tempVal:!0,onTempChange:t.handleValueChange},null,8,["formData","component","componentMap","disabled","onTempChange"])):(0,o.kq)("",!0):((0,o.wg)(),(0,o.iD)("div",w,[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(t.config.content,(function(e,n){return(0,o.wg)(),(0,o.iD)("img",{title:e.name,key:n,class:"atp-subform__file-icon",src:t.getFileTypeIconSrc(e)},null,8,v)})),128))])):((0,o.wg)(),(0,o.j4)(u,{key:1,color:t.config.color},{default:(0,o.w5)((function(){return[(0,o.Uk)((0,i.toDisplayString)(t.config.content),1)]})),_:1},8,["color"])):((0,o.wg)(),(0,o.iD)("span",g,(0,i.toDisplayString)(t.config.content),1))],2)};var y=(0,o.aZ)({name:"SubForm",extends:a.s,components:{ColumnContent:m},props:{title:{type:String,default:function(){return""}},required:{type:Boolean,default:function(){return!1}},placeholder:{type:String,default:function(){return""}}},data:function(){return{showSearchInput:!1,searchKeyword:"",editIndex:-1,subFormValue:[]}},computed:{columnComponentMap:function(){var t=this,e={};return this.extras.columns.forEach((function(n){"field"===n.type&&n.fieldSet&&n.fieldSet.type&&n.fieldSet.componentId&&(e[n.fieldSet.componentId]=t.subFormComponents.find((function(t){return t.id===n.fieldSet.componentId})))})),e}},created:function(){this.setRules(),document.addEventListener("click",this.checkSearchInput)},mounted:function(){this.subFormValue=(0,l.j)(this.value)},beforeUnmount:function(){document.removeEventListener("click",this.checkSearchInput)},methods:{checkSearchInput:function(t){t.target.className.indexOf("atp-subform__search")>=0||t.target.parentNode&&t.target.parentNode.className&&t.target.parentNode.className.indexOf("atp-subform__search")>=0||t.target.parentNode.parentNode&&t.target.parentNode.parentNode.className&&t.target.parentNode.parentNode.className.indexOf("atp-subform__search")>=0?this.showSearchInput=!0:this.showSearchInput=!1},setRules:function(){if(this.rules){var t=this.title;if(this.required&&this.rules.push({required:!0,message:"".concat(t,"不能为空"),trigger:"blur"}),this.extras){switch(this.extras.validType){case"english":this.rules.push({validator:function(t,e,n){(0,l.e)(e)?n():n(new Error("请输入英文"))},trigger:"change"});break;case"numberEnglish":this.rules.push({validator:function(t,e,n){(0,l.d)(e)?n():n(new Error("请输入数字或英文"))},trigger:"change"});break;case"email":this.rules.push({validator:function(t,e,n){(0,l.c)(e)?n():n(new Error("请输入正确的邮箱"))},trigger:"blur"});break;case"idcard":this.rules.push({validator:function(t,e,n){(0,l.b)(e)?n():n(new Error("请输入身份证号码"))},trigger:"blur"});break;case"phone":this.rules.push({validator:function(t,e,n){(0,l.v)(e)?n():n(new Error("请输入正确的手机号码"))},trigger:"blur"})}var e=parseInt(this.extras.minLength),n=parseInt(this.extras.maxLength);isNaN(e)||isNaN(n)?isNaN(e)?isNaN(n)||this.rules.push({validator:function(t,e,o){"string"==typeof e&&e.length&&e.length>n?o(new Error("最多可输入".concat(n,"个字符"))):o()},trigger:"blur"}):this.rules.push({validator:function(t,n,o){"string"==typeof n&&n.length&&n.length<e?o(new Error("至少输入".concat(e,"个字符"))):o()},trigger:"blur"}):this.rules.push({validator:function(t,o,i){"string"==typeof o&&o.length&&(o.length<e||o.length>n)?i(new Error("字符长度必须在".concat(e,"和").concat(n,"之间"))):i()},trigger:"blur"}),this.rules.push({validator:function(e,n,o){"string"==typeof n&&n.length&&n.length>128?o(new Error("".concat(t,"的长度不能大于128"))):o()},trigger:"change"})}}},setDefaultValue:function(){this.extras.defaultValue&&!this.value&&this.$emit("change",this.extras.defaultValue,this.id)},handleSearchShow:function(){this.showSearchInput=!0},handleBtnClick:function(t){var e={};if(this.extras.checkBox){var n=this.$refs.listViewTable;e.selections=n.getSelectionRows()||[]}this.onEvent(t,e)},handleColBtnClick:function(t,e){t&&this.onEvent(t,e)},handlePaginationCurrentChange:function(t){this.onEvent("currentChange",t)},handlePaginationSizeChange:function(t){this.onEvent("sizeChange",t)},handleRowEdit:function(t){this.editIndex=t},handleRowDelete:function(t,e){this.onEvent("onDelete",{data:t,key:this.id}),this.subFormValue.splice(e,1),this.value=(0,l.j)(this.subFormValue)},handleRowSave:function(t,e){this.onEvent("onSave",{data:t,key:this.id}),this.editIndex=-1,this.value[e]=(0,l.j)(this.subFormValue[e])},handleRowCancel:function(t){this.editIndex=-1,this.subFormValue[t]=(0,l.j)(this.value[t])}}}),b={class:"atp-subform"},k=(0,o._)("div",{class:"atp-subform__label"},null,-1),x={class:"atp-subform__content"},C={class:"atp-subform__action"},_={class:"atp-subform__action--left"},S=(0,o.Uk)("test"),D={class:"atp-subform__action--right"},E=(0,o.Uk)("搜索 "),j=(0,o.Uk)("过滤 "),I=(0,o.Uk)("显示列 "),N={key:0},O=(0,o.Uk)("编辑"),V=(0,o.Uk)("删除"),F={key:1},M=(0,o.Uk)("保存"),W=(0,o.Uk)("取消");y.render=function(t,e,n,a,l,u){var c=(0,o.up)("el-button"),s=(0,o.up)("el-input"),f=(0,o.up)("Search"),d=(0,o.up)("el-icon"),p=(0,o.up)("Filter"),h=(0,o.up)("View"),m=(0,o.up)("el-table-column"),g=(0,o.up)("column-content"),w=(0,o.up)("el-table"),v=(0,o.up)("el-form"),y=(0,o.up)("el-pagination");return(0,o.wg)(),(0,o.iD)("div",b,[k,(0,o._)("div",x,[(0,o._)("div",C,[(0,o._)("div",_,[(0,o.Wm)(c,{type:"primary"},{default:(0,o.w5)((function(){return[S]})),_:1})]),(0,o._)("div",D,[t.showSearchInput?((0,o.wg)(),(0,o.j4)(s,{key:0,modelValue:t.searchKeyword,"onUpdate:modelValue":e[0]||(e[0]=function(e){return t.searchKeyword=e}),class:"atp-subform__search",placeholder:"请输入"},null,8,["modelValue"])):((0,o.wg)(),(0,o.j4)(c,{key:1,text:"",onClick:(0,r.withModifiers)(t.handleSearchShow,["stop"])},{default:(0,o.w5)((function(){return[(0,o.Wm)(d,{class:"mr-2"},{default:(0,o.w5)((function(){return[(0,o.Wm)(f)]})),_:1}),E]})),_:1},8,["onClick"])),(0,o.Wm)(c,{text:""},{default:(0,o.w5)((function(){return[(0,o.Wm)(d,{class:"mr-2"},{default:(0,o.w5)((function(){return[(0,o.Wm)(p)]})),_:1}),j]})),_:1}),(0,o.Wm)(c,{text:""},{default:(0,o.w5)((function(){return[(0,o.Wm)(d,{class:"mr-2"},{default:(0,o.w5)((function(){return[(0,o.Wm)(h)]})),_:1}),I]})),_:1})])]),(0,o.Wm)(v,{"label-width":"0px"},{default:(0,o.w5)((function(){return[(0,o.Wm)(w,{data:t.subFormValue,stripe:"",border:"",style:{width:"100%"}},{default:(0,o.w5)((function(){return[t.extras.checkBox?((0,o.wg)(),(0,o.j4)(m,{key:0,type:"selection",fixed:"left",width:40,align:"center"})):(0,o.kq)("",!0),t.extras.showNum?((0,o.wg)(),(0,o.j4)(m,{key:1,label:"序号",fixed:"left",width:60,align:"center"},{default:(0,o.w5)((function(t){var e=t.$index;return[(0,o.Uk)((0,i.toDisplayString)(e+1),1)]})),_:1})):(0,o.kq)("",!0),((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(t.extras.columns,(function(e,n){return(0,o.wg)(),(0,o.iD)(o.HY,null,["field"===e.type?((0,o.wg)(),(0,o.j4)(m,{key:"field-".concat(n),label:e.label,width:e.width||"",align:e.align||"left"},{default:(0,o.w5)((function(n){var i=n.row,r=n.$index;return[(0,o.Wm)(g,{row:i,column:e,isEdit:t.editIndex===r,componentMap:t.columnComponentMap,onClick:function(n){return t.handleColBtnClick(e.clickEvent,i)}},null,8,["row","column","isEdit","componentMap","onClick"])]})),_:2},1032,["label","width","align"])):((0,o.wg)(),(0,o.j4)(m,{fixed:"right",key:"button-".concat(n),label:e.label,width:e.width||"",align:e.align||"left"},{default:(0,o.w5)((function(n){var r=n.row;n.$index;return[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e.actionConfig,(function(e){return(0,o.wg)(),(0,o.iD)(o.HY,null,[t.getComponentDisplay(r,e)&&(t.isAdmin||t.checkPermission(e.permission))?((0,o.wg)(),(0,o.j4)(c,{key:e.buttonEvent,type:e.buttonType,link:"",onClick:function(n){return t.handleColBtnClick(e.buttonEvent,r)}},{default:(0,o.w5)((function(){return[(0,o.Uk)((0,i.toDisplayString)(e.buttonName),1)]})),_:2},1032,["type","onClick"])):(0,o.kq)("",!0)],64)})),256))]})),_:2},1032,["label","width","align"]))],64)})),256)),t.extras.rowEdit?((0,o.wg)(),(0,o.j4)(m,{key:2,label:"操作",fixed:"right",width:120,align:"center"},{default:(0,o.w5)((function(e){var n=e.row,i=e.$index;return[t.editIndex!==i?((0,o.wg)(),(0,o.iD)("div",N,[(0,o.Wm)(c,{onClick:function(e){return t.handleRowEdit(i)},link:""},{default:(0,o.w5)((function(){return[O]})),_:2},1032,["onClick"]),t.extras.rowDelete?((0,o.wg)(),(0,o.j4)(c,{key:0,onClick:function(e){return t.handleRowDelete(n,i)},link:""},{default:(0,o.w5)((function(){return[V]})),_:2},1032,["onClick"])):(0,o.kq)("",!0)])):((0,o.wg)(),(0,o.iD)("div",F,[(0,o.Wm)(c,{onClick:function(e){return t.handleRowSave(n,i)},link:""},{default:(0,o.w5)((function(){return[M]})),_:2},1032,["onClick"]),(0,o.Wm)(c,{onClick:function(e){return t.handleRowCancel(i)},link:""},{default:(0,o.w5)((function(){return[W]})),_:2},1032,["onClick"])]))]})),_:1})):(0,o.kq)("",!0)]})),_:1},8,["data"])]})),_:1}),(0,o.Wm)(y,{small:"",background:"",class:"atp-subform__pagination",layout:"sizes, prev, pager, next",total:30})])])}},86462:function(t,e,n){"use strict";var o=n(53171),i=n(10905),r=n(43329),a=n(39646),l=n(96038),u=Math.min,c=[].lastIndexOf,s=!!c&&1/[1].lastIndexOf(1,-0)<0,f=l("lastIndexOf"),d=s||!f;t.exports=d?function(t){if(s)return o(c,this,arguments)||0;var e=i(this),n=a(e),l=n-1;for(arguments.length>1&&(l=u(l,r(arguments[1]))),l<0&&(l=n+l);l>=0;l--)if(l in e&&e[l]===t)return l||0;return-1}:c},74083:function(t,e,n){"use strict";var o=n(23103),i=n(65968),r=n(19540).indexOf,a=n(96038),l=i([].indexOf),u=!!l&&1/l([1],1,-0)<0,c=a("indexOf");o({target:"Array",proto:!0,forced:u||!c},{indexOf:function(t){var e=arguments.length>1?arguments[1]:void 0;return u?l(this,t,e)||0:r(this,t,e)}})},16781:function(t,e,n){"use strict";var o=n(23103),i=n(65968),r=n(9337),a=n(10905),l=n(96038),u=i([].join),c=r!=Object,s=l("join",",");o({target:"Array",proto:!0,forced:c||!s},{join:function(t){return u(a(this),void 0===t?",":t)}})},74660:function(t,e,n){var o=n(23103),i=n(86462);o({target:"Array",proto:!0,forced:i!==[].lastIndexOf},{lastIndexOf:i})}}]);