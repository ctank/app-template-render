"use strict";(self.webpackChunkapp_template_builder=self.webpackChunkapp_template_builder||[]).push([[8329],{94456:function(e,t,o){o.d(t,{S:function(){return p}});var s=o(34441),i=o(24677),n=o(13484),r=o(38431),u=o(11138),h=o(20303),a=o(31396),l=o(14963),_=o(8964),c=o(57841),m=o(62496);class p extends m.O{constructor(e,t,o){super(),this._mouseLeaveMonitor=null,this._context=e,this.viewController=t,this.viewHelper=o,this.mouseTargetFactory=new h.rp(this._context,o),this._mouseDownOperation=this._register(new v(this._context,this.viewController,this.viewHelper,((e,t)=>this._createMouseTarget(e,t)),(e=>this._getMouseColumn(e)))),this.lastMouseLeaveTime=-1,this._height=this._context.configuration.options.get(133).height;const n=new a.N5(this.viewHelper.viewDomNode);this._register(n.onContextMenu(this.viewHelper.viewDomNode,(e=>this._onContextMenu(e,!0)))),this._register(n.onMouseMove(this.viewHelper.viewDomNode,(e=>{this._onMouseMove(e),this._mouseLeaveMonitor||(this._mouseLeaveMonitor=s.nm(document,"mousemove",(e=>{this.viewHelper.viewDomNode.contains(e.target)||this._onMouseLeave(new a.gy(e,!1,this.viewHelper.viewDomNode))})))}))),this._register(n.onMouseUp(this.viewHelper.viewDomNode,(e=>this._onMouseUp(e)))),this._register(n.onMouseLeave(this.viewHelper.viewDomNode,(e=>this._onMouseLeave(e))));let r=0;this._register(n.onPointerDown(this.viewHelper.viewDomNode,((e,t)=>{r=t}))),this._register(s.nm(this.viewHelper.viewDomNode,s.tw.POINTER_UP,(e=>{this._mouseDownOperation.onPointerUp()}))),this._register(n.onMouseDown(this.viewHelper.viewDomNode,(e=>this._onMouseDown(e,r))));this._register(s.nm(this.viewHelper.viewDomNode,s.tw.MOUSE_WHEEL,(e=>{if(this.viewController.emitMouseWheel(e),!this._context.configuration.options.get(70))return;const t=new i.q(e);if(u.dz?(e.metaKey||e.ctrlKey)&&!e.shiftKey&&!e.altKey:e.ctrlKey&&!e.metaKey&&!e.shiftKey&&!e.altKey){const e=l.C.getZoomLevel(),o=t.deltaY>0?1:-1;l.C.setZoomLevel(e+o),t.preventDefault(),t.stopPropagation()}}),{capture:!0,passive:!1})),this._context.addEventHandler(this)}dispose(){this._context.removeEventHandler(this),this._mouseLeaveMonitor&&(this._mouseLeaveMonitor.dispose(),this._mouseLeaveMonitor=null),super.dispose()}onConfigurationChanged(e){if(e.hasChanged(133)){const e=this._context.configuration.options.get(133).height;this._height!==e&&(this._height=e,this._mouseDownOperation.onHeightChanged())}return!1}onCursorStateChanged(e){return this._mouseDownOperation.onCursorStateChanged(e),!1}onFocusChanged(e){return!1}onScrollChanged(e){return this._mouseDownOperation.onScrollChanged(),!1}getTargetAtClientPoint(e,t){const o=new a.rU(e,t).toPageCoordinates(),s=(0,a.kG)(this.viewHelper.viewDomNode);if(o.y<s.y||o.y>s.y+s.height||o.x<s.x||o.x>s.x+s.width)return null;const i=(0,a.Pp)(this.viewHelper.viewDomNode,s,o);return this.mouseTargetFactory.createMouseTarget(this.viewHelper.getLastRenderData(),s,o,i,null)}_createMouseTarget(e,t){let o=e.target;if(!this.viewHelper.viewDomNode.contains(o)){const t=s.Ay(this.viewHelper.viewDomNode);t&&(o=t.elementsFromPoint(e.posx,e.posy).find((e=>this.viewHelper.viewDomNode.contains(e))))}return this.mouseTargetFactory.createMouseTarget(this.viewHelper.getLastRenderData(),e.editorPos,e.pos,e.relativePos,t?o:null)}_getMouseColumn(e){return this.mouseTargetFactory.getMouseColumn(e.relativePos)}_onContextMenu(e,t){this.viewController.emitContextMenu({event:e,target:this._createMouseTarget(e,t)})}_onMouseMove(e){if(this.mouseTargetFactory.mouseTargetIsWidget(e)||e.preventDefault(),this._mouseDownOperation.isActive())return;e.timestamp<this.lastMouseLeaveTime||this.viewController.emitMouseMove({event:e,target:this._createMouseTarget(e,!0)})}_onMouseLeave(e){this._mouseLeaveMonitor&&(this._mouseLeaveMonitor.dispose(),this._mouseLeaveMonitor=null),this.lastMouseLeaveTime=(new Date).getTime(),this.viewController.emitMouseLeave({event:e,target:null})}_onMouseUp(e){this.viewController.emitMouseUp({event:e,target:this._createMouseTarget(e,!0)})}_onMouseDown(e,t){const o=this._createMouseTarget(e,!0),s=6===o.type||7===o.type,i=2===o.type||3===o.type||4===o.type,n=3===o.type,r=this._context.configuration.options.get(100),h=8===o.type||5===o.type,a=9===o.type;let l=e.leftButton||e.middleButton;u.dz&&e.leftButton&&e.ctrlKey&&(l=!1);const _=()=>{e.preventDefault(),this.viewHelper.focusTextArea()};if(l&&(s||n&&r))_(),this._mouseDownOperation.start(o.type,e,t);else if(i)e.preventDefault();else if(h){const s=o.detail;l&&this.viewHelper.shouldSuppressMouseDownOnViewZone(s.viewZoneId)&&(_(),this._mouseDownOperation.start(o.type,e,t),e.preventDefault())}else a&&this.viewHelper.shouldSuppressMouseDownOnWidget(o.detail)&&(_(),e.preventDefault());this.viewController.emitMouseDown({event:e,target:o})}}class v extends r.JT{constructor(e,t,o,s,i){super(),this._context=e,this._viewController=t,this._viewHelper=o,this._createMouseTarget=s,this._getMouseColumn=i,this._mouseMoveMonitor=this._register(new a.AL(this._viewHelper.viewDomNode)),this._onScrollTimeout=this._register(new n._F),this._mouseState=new d,this._currentSelection=new c.Y(1,1,1,1),this._isActive=!1,this._lastMouseEvent=null}dispose(){super.dispose()}isActive(){return this._isActive}_onMouseDownThenMove(e){this._lastMouseEvent=e,this._mouseState.setModifiers(e);const t=this._findMousePosition(e,!1);t&&(this._mouseState.isDragAndDrop?this._viewController.emitMouseDrag({event:e,target:t}):this._dispatchMouse(t,!0))}start(e,t,o){this._lastMouseEvent=t,this._mouseState.setStartedOnLineNumbers(3===e),this._mouseState.setStartButtons(t),this._mouseState.setModifiers(t);const s=this._findMousePosition(t,!0);if(!s||!s.position)return;this._mouseState.trySetCount(t.detail,s.position),t.detail=this._mouseState.count;const i=this._context.configuration.options;if(!i.get(83)&&i.get(31)&&!i.get(18)&&!this._mouseState.altKey&&t.detail<2&&!this._isActive&&!this._currentSelection.isEmpty()&&6===s.type&&s.position&&this._currentSelection.containsPosition(s.position))return this._mouseState.isDragAndDrop=!0,this._isActive=!0,void this._mouseMoveMonitor.startMonitoring(this._viewHelper.viewLinesDomNode,o,t.buttons,(e=>this._onMouseDownThenMove(e)),(e=>{const t=this._findMousePosition(this._lastMouseEvent,!1);e&&e instanceof KeyboardEvent?this._viewController.emitMouseDropCanceled():this._viewController.emitMouseDrop({event:this._lastMouseEvent,target:t?this._createMouseTarget(this._lastMouseEvent,!0):null}),this._stop()}));this._mouseState.isDragAndDrop=!1,this._dispatchMouse(s,t.shiftKey),this._isActive||(this._isActive=!0,this._mouseMoveMonitor.startMonitoring(this._viewHelper.viewLinesDomNode,o,t.buttons,(e=>this._onMouseDownThenMove(e)),(()=>this._stop())))}_stop(){this._isActive=!1,this._onScrollTimeout.cancel()}onHeightChanged(){this._mouseMoveMonitor.stopMonitoring()}onPointerUp(){this._mouseMoveMonitor.stopMonitoring()}onScrollChanged(){this._isActive&&this._onScrollTimeout.setIfNotSet((()=>{if(!this._lastMouseEvent)return;const e=this._findMousePosition(this._lastMouseEvent,!1);e&&(this._mouseState.isDragAndDrop||this._dispatchMouse(e,!0))}),10)}onCursorStateChanged(e){this._currentSelection=e.selections[0]}_getPositionOutsideEditor(e){const t=e.editorPos,o=this._context.viewModel,s=this._context.viewLayout,i=this._getMouseColumn(e);if(e.posy<t.y){const o=Math.max(s.getCurrentScrollTop()-(t.y-e.posy),0),n=h.Iq.getZoneAtCoord(this._context,o);if(n){const e=this._helpPositionJumpOverViewZone(n);if(e)return h.ZP.createOutsideEditor(i,e)}const r=s.getLineNumberAtVerticalOffset(o);return h.ZP.createOutsideEditor(i,new _.L(r,1))}if(e.posy>t.y+t.height){const t=s.getCurrentScrollTop()+e.relativePos.y,n=h.Iq.getZoneAtCoord(this._context,t);if(n){const e=this._helpPositionJumpOverViewZone(n);if(e)return h.ZP.createOutsideEditor(i,e)}const r=s.getLineNumberAtVerticalOffset(t);return h.ZP.createOutsideEditor(i,new _.L(r,o.getLineMaxColumn(r)))}const n=s.getLineNumberAtVerticalOffset(s.getCurrentScrollTop()+e.relativePos.y);return e.posx<t.x?h.ZP.createOutsideEditor(i,new _.L(n,1)):e.posx>t.x+t.width?h.ZP.createOutsideEditor(i,new _.L(n,o.getLineMaxColumn(n))):null}_findMousePosition(e,t){const o=this._getPositionOutsideEditor(e);if(o)return o;const s=this._createMouseTarget(e,t);if(!s.position)return null;if(8===s.type||5===s.type){const e=this._helpPositionJumpOverViewZone(s.detail);if(e)return h.ZP.createViewZone(s.type,s.element,s.mouseColumn,e,s.detail)}return s}_helpPositionJumpOverViewZone(e){const t=new _.L(this._currentSelection.selectionStartLineNumber,this._currentSelection.selectionStartColumn),o=e.positionBefore,s=e.positionAfter;return o&&s?o.isBefore(t)?o:s:null}_dispatchMouse(e,t){e.position&&this._viewController.dispatchMouse({position:e.position,mouseColumn:e.mouseColumn,startedOnLineNumbers:this._mouseState.startedOnLineNumbers,inSelectionMode:t,mouseDownCount:this._mouseState.count,altKey:this._mouseState.altKey,ctrlKey:this._mouseState.ctrlKey,metaKey:this._mouseState.metaKey,shiftKey:this._mouseState.shiftKey,leftButton:this._mouseState.leftButton,middleButton:this._mouseState.middleButton,onInjectedText:6===e.type&&null!==e.detail.injectedText})}}class d{constructor(){this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._leftButton=!1,this._middleButton=!1,this._startedOnLineNumbers=!1,this._lastMouseDownPosition=null,this._lastMouseDownPositionEqualCount=0,this._lastMouseDownCount=0,this._lastSetMouseDownCountTime=0,this.isDragAndDrop=!1}get altKey(){return this._altKey}get ctrlKey(){return this._ctrlKey}get metaKey(){return this._metaKey}get shiftKey(){return this._shiftKey}get leftButton(){return this._leftButton}get middleButton(){return this._middleButton}get startedOnLineNumbers(){return this._startedOnLineNumbers}get count(){return this._lastMouseDownCount}setModifiers(e){this._altKey=e.altKey,this._ctrlKey=e.ctrlKey,this._metaKey=e.metaKey,this._shiftKey=e.shiftKey}setStartButtons(e){this._leftButton=e.leftButton,this._middleButton=e.middleButton}setStartedOnLineNumbers(e){this._startedOnLineNumbers=e}trySetCount(e,t){const o=(new Date).getTime();o-this._lastSetMouseDownCountTime>d.CLEAR_MOUSE_DOWN_COUNT_TIME&&(e=1),this._lastSetMouseDownCountTime=o,e>this._lastMouseDownCount+1&&(e=this._lastMouseDownCount+1),this._lastMouseDownPosition&&this._lastMouseDownPosition.equals(t)?this._lastMouseDownPositionEqualCount++:this._lastMouseDownPositionEqualCount=1,this._lastMouseDownPosition=t,this._lastMouseDownCount=Math.min(e,this._lastMouseDownPositionEqualCount)}}d.CLEAR_MOUSE_DOWN_COUNT_TIME=400}}]);