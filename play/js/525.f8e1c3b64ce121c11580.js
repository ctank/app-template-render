"use strict";(self.webpackChunkapp_template_builder=self.webpackChunkapp_template_builder||[]).push([[525],{91286:function(e,t,i){i.d(t,{s:function(){return a}});i(77950),i(85940);var n=i(87263),r=i(27875),a={name:"FormComponentBase",components:{},inject:["onChange","onGetValue","onEvent"],props:{id:{type:String,default:function(){return""}},type:{type:String,default:function(){return""}},extras:{type:Object,default:function(){return{}}},placeholder:{type:String,default:function(){return"请输入"}},rules:{type:Array,default:function(){return[]}},fieldPath:{type:String,default:function(){return""}},componentMap:{type:Object,default:function(){return{}}},formData:{type:Object,default:function(){return{}}}},data:function(){return{}},computed:{value:{get:function(){var e="";return this.formData&&this.fieldPath&&(e=(0,n.g)(this.formData,this.fieldPath)),e},set:function(e){this.onChange(e,this.id)}},validProp:function(){return this.fieldPath.replace(/\//g,".")}},render:function(e,t,i,n,a,s){return(0,r.wg)(),(0,r.iD)("div")}}},48525:function(e,t,i){i.r(t),i.d(t,{default:function(){return m}});i(74660),i(26936),i(39529),i(31235),i(77950),i(48319),i(58188),i(1939),i(68995),i(18178),i(17368),i(51172),i(88233),i(21850),i(9949),i(99805);var n=i(27875),r=i(50349),a=i(91286),s=i(87263),l={excel:["xls","xlsx"],music:["mp3","wav"],pic:["jpg","png","gif"],ppt:["ppt","pptx"],video:["mp4"],word:["doc","docx"],zip:["zip","rar","7z"]},o=(0,n.aZ)({name:"FileList",extends:a.s,props:{fileList:{type:Array,default:function(){return[]}},disabled:{type:Boolean,default:function(){return!1}}},data:function(){return{fileTypeIcons:s.F}},watch:{},created:function(){},methods:{getFileTypeIconSrc:function(e){var t=s.F.file,i=e.name.lastIndexOf(".");if(i>=0){var n=e.name.substr(i+1);if(s.j[n.toLowerCase()])t=s.j[n.toLowerCase()];else for(var r in l)l[r].includes(n)&&(t=s.F[r])}return t},handleFilePreview:function(e){this.$emit("preview",e)},handleFIleRemove:function(e){this.$emit("remove",e)}}}),u={class:"atp-file-list"},c={class:"atp-file-list__content"},f={class:"atp-file-list__icon"},d=["src"],p={class:"atp-file-list__title"},h=["title","onClick"],v={class:"atp-file-list_action"},g={key:0,class:"atp-progress atp-file-progress"};o.render=function(e,t,i,a,s,l){var o=(0,n.up)("Delete"),m=(0,n.up)("el-icon");return(0,n.wg)(),(0,n.iD)("div",u,[((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(e.fileList,(function(t,i){return(0,n.wg)(),(0,n.iD)("div",{class:(0,r.normalizeClass)(["atp-file-list__item",t.percent&&t.percent<100?"atp-file-list__item--progress":""]),key:t.url},[(0,n._)("div",c,[(0,n._)("div",f,[(0,n._)("img",{class:"atp-file-icon",src:e.getFileTypeIconSrc(t)},null,8,d)]),(0,n._)("div",p,[(0,n._)("span",{title:t.name,onClick:function(i){return e.handleFilePreview(t)}},(0,r.toDisplayString)(t.name),9,h)]),(0,n._)("div",v,[(0,n.Wm)(m,{title:"删除",onClick:function(t){return e.handleFIleRemove(i)}},{default:(0,n.w5)((function(){return[(0,n.Wm)(o)]})),_:2},1032,["onClick"])])]),t.percent&&t.percent<100?((0,n.wg)(),(0,n.iD)("div",g,[(0,n._)("div",{class:"atp-progress__bar atp-progress__bar--striped atp-progress__bar--animated",style:(0,r.normalizeStyle)("width:".concat(t.percent||100,"%;"))},null,4)])):(0,n.kq)("",!0)],2)})),128))])};var m=(0,n.aZ)({name:"FileUpload",extends:a.s,components:{FileList:o},props:{title:{type:String,default:function(){return""}},required:{type:Boolean,default:function(){return!1}},placeholder:{type:String,default:function(){return""}}},data:function(){return{}},computed:{showUploadBtn:function(){return 1!==this.extras.maxLimit||this.value.length!==this.extras.maxLimit},uploadAccept:function(){if(this.extras.fileType){var e=this.extras.fileType.split(";"),t="";return e.forEach((function(e){t.length&&(t+=" "),t+=".".concat(e,",")})),t}return"*"},disabledUpload:function(){return this.extras.maxLimit>1&&this.value.length===this.extras.maxLimit}},created:function(){this.setRules(),this.setDefaultValue()},methods:{setRules:function(){if(this.rules){var e=this.title;if(this.required&&this.rules.push({required:!0,message:"".concat(e,"不能为空"),trigger:"submit"}),this.extras){var t=parseInt(this.extras.minLimit),i=parseInt(this.extras.maxLimit);isNaN(t)||isNaN(i)?isNaN(t)?isNaN(i)||this.rules.push({validator:function(e,t,n){Array.isArray(t)&&t.length>i?n(new Error("最多允许上传".concat(i,"个文件"))):n()},trigger:"submit"}):this.rules.push({validator:function(e,i,n){Array.isArray(i)&&i.length<t?n(new Error("最少需要上传".concat(t,"个文件"))):n()},trigger:"submit"}):this.rules.push({validator:function(e,n,r){Array.isArray(n)&&(n.length<t||n.length>i)?r(new Error("上传文件数量在".concat(t,"和").concat(i,"之间"))):r()},trigger:"submit"})}}},setDefaultValue:function(){this.value||this.onChange([],this.id)},beforeUpload:function(e){var t=this.__$app.config.globalProperties.$message,i=new RegExp("^[一-龥A-Za-z0-9_-]+$");if(e.name.split(".").length>2||!i.test(this.filename))return t?t({showClose:!0,message:"文件名仅能包含中文数字英文字母_-",type:"error"}):alert("文件名仅能包含中文数字英文字母_-"),!1;var n=this.extras.fileSizeLimit;if(n.value){var r="MB"===n.unit?1024*n.value:n.value;if(e.size/1024>r)return t?t({showClose:!0,message:"上传文件大小不能超过".concat(n.value).concat(n.unit),type:"error"}):alert("上传文件大小不能超过".concat(n.value).concat(n.unit)),!1}return!0},uploadSuccess:function(e,t,i){var n=this,r=function(t){var r=n.extras.uploadConfig,a=r.nameFieldPath,l=r.urlFieldPath,o=r.thumbUrlFieldPath,u=t.name;a&&(u=(0,s.g)(e,a));var c="";l&&(c=(0,s.g)(e,l));var f=c;o&&(c=(0,s.g)(e,o));var d=i.findIndex((function(e){return e.uid&&e.uid===t.uid}));i[d]={name:u,url:c,thumbUrl:f,uid:t.uid,status:t.status,percentage:t.percentage}};this.extras.actionConfig.success?this.onEvent(this.extras.actionConfig.success,{file:t,res:e,id:this.id,fieldPath:this.fieldPath},r):r(t)},uploadError:function(e,t,i){this.extras.actionConfig.success&&this.onEvent(this.extras.actionConfig.success,{file:t,err:e,id:this.id,fieldPath:this.fieldPath})},handleFilePreview:function(e){this.extras.actionConfig.preview&&this.onEvent(this.extras.actionConfig.preview,{file:e,id:this.id,fieldPath:this.fieldPath})},handleFileRemove:function(e){var t=this;if(Array.isArray(this.value)){var i=this.value[e];i.status="uploading";var n=function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"success";if(i.status="success","success"===n){var r=(0,s.h)(t.value);r.splice(e,1),t.onChange(r,t.id)}};this.extras.actionConfig.remove?this.onEvent(this.extras.actionConfig.remove,{file:i,id:this.id,fieldPath:this.fieldPath},n):n()}}}}),_={class:"atp-file-upload"},w=(0,n.Uk)("点击上传");m.render=function(e,t,i,a,s,l){var o=(0,n.up)("el-button"),u=(0,n.up)("el-upload"),c=(0,n.up)("file-list"),f=(0,n.up)("el-form-item");return(0,n.wg)(),(0,n.j4)(f,{label:e.title,class:(0,r.normalizeClass)(e.required?"is-required":""),prop:e.validProp,rules:e.rules},{default:(0,n.w5)((function(){return[(0,n._)("div",_,[(0,n.Wm)(u,{class:"atp-file-upload__btn","file-list":e.value,"onUpdate:file-list":t[0]||(t[0]=function(t){return e.value=t}),accept:e.uploadAccept,action:e.extras.uploadConfig.action,disabled:e.disabledUpload,"show-file-list":!1,"before-upload":e.beforeUpload,"on-success":e.uploadSuccess,"on-error":e.uploadError},{default:(0,n.w5)((function(){return[(0,n.Wm)(o,{disabled:e.disabledUpload,type:"primary"},{default:(0,n.w5)((function(){return[w]})),_:1},8,["disabled"])]})),_:1},8,["file-list","accept","action","disabled","before-upload","on-success","on-error"]),e.value.length?((0,n.wg)(),(0,n.j4)(c,{key:0,class:"atp-file-upload__list",width:e.extras.width,height:e.extras.height,"file-list":e.value,onPreview:e.handleFilePreview,onRemove:e.handleFileRemove},null,8,["width","height","file-list","onPreview","onRemove"])):(0,n.kq)("",!0)])]})),_:1},8,["label","class","prop","rules"])}}}]);