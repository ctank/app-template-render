"use strict";(self.webpackChunkapp_template_builder=self.webpackChunkapp_template_builder||[]).push([[8308],{65041:function(e,t,i){i.d(t,{q:function(){return o}});const o=(0,i(44333).yh)("modelService")},94657:function(e,t,i){i.d(t,{b$:function(){return P},e3:function(){return F},tw:function(){return W}});var o=i(56709),n=i(38431),s=i(11138),r=i(20996),a=i(132),d=i(56318),l=i(90638),c=i(47626),h=i(65041),u=i(16576),_=i(71177),g=i(13484),m=i(97464),p=i(58566),S=i(59271),f=i(48900),v=i(32916),D=i(75565),R=i(5007),k=i(79257),C=i(10165),M=i(23127),O=i(29173),I=i(69060),T=i(69344),L=i(35921),b=function(e,t,i,o){var n,s=arguments.length,r=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(r=(s<3?n(r):s>3?n(t,i,r):n(t,i))||r);return s>3&&r&&Object.defineProperty(t,i,r),r},z=function(e,t){return function(i,o){t(i,o,e)}};function E(e){return e.toString()}function y(e){const t=new v.yP,i=e.createSnapshot();let o;for(;o=i.read();)t.update(o);return t.digest()}class A{constructor(e,t,i){this._modelEventListeners=new n.SL,this.model=e,this._languageSelection=null,this._languageSelectionListener=null,this._modelEventListeners.add(e.onWillDispose((()=>t(e)))),this._modelEventListeners.add(e.onDidChangeLanguage((t=>i(e,t))))}_disposeLanguageSelection(){this._languageSelectionListener&&(this._languageSelectionListener.dispose(),this._languageSelectionListener=null)}dispose(){this._modelEventListeners.dispose(),this._disposeLanguageSelection()}setLanguage(e){this._disposeLanguageSelection(),this._languageSelection=e,this._languageSelectionListener=this._languageSelection.onDidChange((()=>this.model.setMode(e.languageId))),this.model.setMode(e.languageId)}}const w=s.IJ||s.dz?1:2;class U{constructor(e,t,i,o,n,s,r,a){this.uri=e,this.initialUndoRedoSnapshot=t,this.time=i,this.sharesUndoRedoStack=o,this.heapSize=n,this.sha1=s,this.versionId=r,this.alternativeVersionId=a}}let P=class e extends n.JT{constructor(e,t,i,n,s,r,a,d,l){super(),this._configurationService=e,this._resourcePropertiesService=t,this._themeService=i,this._logService=n,this._undoRedoService=s,this._languageService=r,this._languageConfigurationService=a,this._languageFeatureDebounceService=d,this._onModelAdded=this._register(new o.Q5),this.onModelAdded=this._onModelAdded.event,this._onModelRemoved=this._register(new o.Q5),this.onModelRemoved=this._onModelRemoved.event,this._onModelModeChanged=this._register(new o.Q5),this.onModelLanguageChanged=this._onModelModeChanged.event,this._modelCreationOptionsByLanguageAndResource=Object.create(null),this._models={},this._disposedModels=new Map,this._disposedModelsHeapSize=0,this._semanticStyling=this._register(new q(this._themeService,this._languageService,this._logService)),this._register(this._configurationService.onDidChangeConfiguration((()=>this._updateModelOptions()))),this._updateModelOptions(),this._register(new V(this._semanticStyling,this,this._themeService,this._configurationService,this._languageFeatureDebounceService,l))}static _readModelOptions(e,t){var i;let o=d.D.tabSize;if(e.editor&&void 0!==e.editor.tabSize){const t=parseInt(e.editor.tabSize,10);isNaN(t)||(o=t),o<1&&(o=1)}let n=o;if(e.editor&&void 0!==e.editor.indentSize&&"tabSize"!==e.editor.indentSize){const t=parseInt(e.editor.indentSize,10);isNaN(t)||(n=t),n<1&&(n=1)}let s=d.D.insertSpaces;e.editor&&void 0!==e.editor.insertSpaces&&(s="false"!==e.editor.insertSpaces&&Boolean(e.editor.insertSpaces));let r=w;const a=e.eol;"\r\n"===a?r=2:"\n"===a&&(r=1);let l=d.D.trimAutoWhitespace;e.editor&&void 0!==e.editor.trimAutoWhitespace&&(l="false"!==e.editor.trimAutoWhitespace&&Boolean(e.editor.trimAutoWhitespace));let c=d.D.detectIndentation;e.editor&&void 0!==e.editor.detectIndentation&&(c="false"!==e.editor.detectIndentation&&Boolean(e.editor.detectIndentation));let h=d.D.largeFileOptimizations;e.editor&&void 0!==e.editor.largeFileOptimizations&&(h="false"!==e.editor.largeFileOptimizations&&Boolean(e.editor.largeFileOptimizations));let u=d.D.bracketPairColorizationOptions;return(null===(i=e.editor)||void 0===i?void 0:i.bracketPairColorization)&&"object"==typeof e.editor.bracketPairColorization&&(u={enabled:!!e.editor.bracketPairColorization.enabled,independentColorPoolPerBracketType:!!e.editor.bracketPairColorization.independentColorPoolPerBracketType}),{isForSimpleWidget:t,tabSize:o,indentSize:n,insertSpaces:s,detectIndentation:c,defaultEOL:r,trimAutoWhitespace:l,largeFileOptimizations:h,bracketPairColorizationOptions:u}}_getEOL(e,t){if(e)return this._resourcePropertiesService.getEOL(e,t);const i=this._configurationService.getValue("files.eol",{overrideIdentifier:t});return i&&"string"==typeof i&&"auto"!==i?i:3===s.OS||2===s.OS?"\n":"\r\n"}_shouldRestoreUndoStack(){const e=this._configurationService.getValue("files.restoreUndoStack");return"boolean"!=typeof e||e}getCreationOptions(t,i,o){let n=this._modelCreationOptionsByLanguageAndResource[t+i];if(!n){const s=this._configurationService.getValue("editor",{overrideIdentifier:t,resource:i}),r=this._getEOL(i,t);n=e._readModelOptions({editor:s,eol:r},o),this._modelCreationOptionsByLanguageAndResource[t+i]=n}return n}_updateModelOptions(){const t=this._modelCreationOptionsByLanguageAndResource;this._modelCreationOptionsByLanguageAndResource=Object.create(null);const i=Object.keys(this._models);for(let o=0,n=i.length;o<n;o++){const n=i[o],s=this._models[n],r=s.model.getLanguageId(),a=s.model.uri,d=t[r+a],l=this.getCreationOptions(r,a,s.model.isForSimpleWidget);e._setModelOptionsForModel(s.model,l,d)}}static _setModelOptionsForModel(e,t,i){i&&i.defaultEOL!==t.defaultEOL&&1===e.getLineCount()&&e.setEOL(1===t.defaultEOL?0:1),i&&i.detectIndentation===t.detectIndentation&&i.insertSpaces===t.insertSpaces&&i.tabSize===t.tabSize&&i.indentSize===t.indentSize&&i.trimAutoWhitespace===t.trimAutoWhitespace&&(0,M.fS)(i.bracketPairColorizationOptions,t.bracketPairColorizationOptions)||(t.detectIndentation?(e.detectIndentation(t.insertSpaces,t.tabSize),e.updateOptions({trimAutoWhitespace:t.trimAutoWhitespace,bracketColorizationOptions:t.bracketPairColorizationOptions})):e.updateOptions({insertSpaces:t.insertSpaces,tabSize:t.tabSize,indentSize:t.indentSize,trimAutoWhitespace:t.trimAutoWhitespace,bracketColorizationOptions:t.bracketPairColorizationOptions}))}_insertDisposedModel(e){this._disposedModels.set(E(e.uri),e),this._disposedModelsHeapSize+=e.heapSize}_removeDisposedModel(e){const t=this._disposedModels.get(E(e));return t&&(this._disposedModelsHeapSize-=t.heapSize),this._disposedModels.delete(E(e)),t}_ensureDisposedModelsHeapSize(e){if(this._disposedModelsHeapSize>e){const t=[];for(this._disposedModels.forEach((e=>{e.sharesUndoRedoStack||t.push(e)})),t.sort(((e,t)=>e.time-t.time));t.length>0&&this._disposedModelsHeapSize>e;){const e=t.shift();this._removeDisposedModel(e.uri),null!==e.initialUndoRedoSnapshot&&this._undoRedoService.restoreSnapshot(e.initialUndoRedoSnapshot)}}}_createModelData(e,t,i,o){const n=this.getCreationOptions(t,i,o),s=new a.yO(e,t,n,i,this._undoRedoService,this._languageService,this._languageConfigurationService);if(i&&this._disposedModels.has(E(i))){const e=this._removeDisposedModel(i),t=this._undoRedoService.getElements(i),o=y(s)===e.sha1;if(o||e.sharesUndoRedoStack){for(const e of t.past)(0,D.e9)(e)&&e.matchesResource(i)&&e.setModel(s);for(const e of t.future)(0,D.e9)(e)&&e.matchesResource(i)&&e.setModel(s);this._undoRedoService.setElementsValidFlag(i,!0,(e=>(0,D.e9)(e)&&e.matchesResource(i))),o&&(s._overwriteVersionId(e.versionId),s._overwriteAlternativeVersionId(e.alternativeVersionId),s._overwriteInitialUndoRedoSnapshot(e.initialUndoRedoSnapshot))}else null!==e.initialUndoRedoSnapshot&&this._undoRedoService.restoreSnapshot(e.initialUndoRedoSnapshot)}const r=E(s.uri);if(this._models[r])throw new Error("ModelService: Cannot add model because it already exists!");const d=new A(s,(e=>this._onWillDispose(e)),((e,t)=>this._onDidChangeLanguage(e,t)));return this._models[r]=d,d}createModel(e,t,i,o=!1){let n;return t?(n=this._createModelData(e,t.languageId,i,o),this.setMode(n.model,t)):n=this._createModelData(e,l.bd,i,o),this._onModelAdded.fire(n.model),n.model}setMode(e,t){if(!t)return;const i=this._models[E(e.uri)];i&&i.setLanguage(t)}getModels(){const e=[],t=Object.keys(this._models);for(let i=0,o=t.length;i<o;i++){const o=t[i];e.push(this._models[o].model)}return e}getModel(e){const t=E(e),i=this._models[t];return i?i.model:null}getSemanticTokensProviderStyling(e){return this._semanticStyling.get(e)}_schemaShouldMaintainUndoRedoElements(e){return e.scheme===R.lg.file||e.scheme===R.lg.vscodeRemote||e.scheme===R.lg.vscodeUserData||e.scheme===R.lg.vscodeNotebookCell||"fake-fs"===e.scheme}_onWillDispose(t){const i=E(t.uri),o=this._models[i],n=this._undoRedoService.getUriComparisonKey(t.uri)!==t.uri.toString();let s=!1,r=0;if(n||this._shouldRestoreUndoStack()&&this._schemaShouldMaintainUndoRedoElements(t.uri)){const e=this._undoRedoService.getElements(t.uri);if(e.past.length>0||e.future.length>0){for(const i of e.past)(0,D.e9)(i)&&i.matchesResource(t.uri)&&(s=!0,r+=i.heapSize(t.uri),i.setModel(t.uri));for(const i of e.future)(0,D.e9)(i)&&i.matchesResource(t.uri)&&(s=!0,r+=i.heapSize(t.uri),i.setModel(t.uri))}}const a=e.MAX_MEMORY_FOR_CLOSED_FILES_UNDO_STACK;if(s)if(!n&&r>a){const e=o.model.getInitialUndoRedoSnapshot();null!==e&&this._undoRedoService.restoreSnapshot(e)}else this._ensureDisposedModelsHeapSize(a-r),this._undoRedoService.setElementsValidFlag(t.uri,!1,(e=>(0,D.e9)(e)&&e.matchesResource(t.uri))),this._insertDisposedModel(new U(t.uri,o.model.getInitialUndoRedoSnapshot(),Date.now(),n,r,y(t),t.getVersionId(),t.getAlternativeVersionId()));else if(!n){const e=o.model.getInitialUndoRedoSnapshot();null!==e&&this._undoRedoService.restoreSnapshot(e)}delete this._models[i],o.dispose(),delete this._modelCreationOptionsByLanguageAndResource[t.getLanguageId()+t.uri],this._onModelRemoved.fire(t)}_onDidChangeLanguage(t,i){const o=i.oldLanguage,n=t.getLanguageId(),s=this.getCreationOptions(o,t.uri,t.isForSimpleWidget),r=this.getCreationOptions(n,t.uri,t.isForSimpleWidget);e._setModelOptionsForModel(t,r,s),this._onModelModeChanged.fire({model:t,oldLanguageId:o})}};P.MAX_MEMORY_FOR_CLOSED_FILES_UNDO_STACK=20971520,P=b([z(0,_.Ui),z(1,u.y),z(2,p.XE),z(3,S.VZ),z(4,f.tJ),z(5,c.O),z(6,O.c_),z(7,I.A),z(8,L.p)],P);const F="editor.semanticHighlighting";function W(e,t,i){var o;const n=null===(o=i.getValue(F,{overrideIdentifier:e.getLanguageId(),resource:e.uri}))||void 0===o?void 0:o.enabled;return"boolean"==typeof n?n:t.getColorTheme().semanticHighlighting}let V=class extends n.JT{constructor(e,t,i,o,n,s){super(),this._watchers=Object.create(null),this._semanticStyling=e;const r=e=>{this._watchers[e.uri.toString()]=new N(e,this._semanticStyling,i,n,s)},a=(e,t)=>{t.dispose(),delete this._watchers[e.uri.toString()]},d=()=>{for(const e of t.getModels()){const t=this._watchers[e.uri.toString()];W(e,i,o)?t||r(e):t&&a(e,t)}};this._register(t.onModelAdded((e=>{W(e,i,o)&&r(e)}))),this._register(t.onModelRemoved((e=>{const t=this._watchers[e.uri.toString()];t&&a(e,t)}))),this._register(o.onDidChangeConfiguration((e=>{e.affectsConfiguration(F)&&d()}))),this._register(i.onDidColorThemeChange(d))}dispose(){for(const e of Object.values(this._watchers))e.dispose();super.dispose()}};V=b([z(1,h.q),z(2,p.XE),z(3,_.Ui),z(4,I.A),z(5,L.p)],V);class q extends n.JT{constructor(e,t,i){super(),this._themeService=e,this._languageService=t,this._logService=i,this._caches=new WeakMap,this._register(this._themeService.onDidColorThemeChange((()=>{this._caches=new WeakMap})))}get(e){return this._caches.has(e)||this._caches.set(e,new k.$(e.getLegend(),this._themeService,this._languageService,this._logService)),this._caches.get(e)}}class B{constructor(e,t,i){this.provider=e,this.resultId=t,this.data=i}dispose(){this.provider.releaseDocumentSemanticTokens(this.resultId)}}let N=class e extends n.JT{constructor(t,i,o,s,r){super(),this._isDisposed=!1,this._model=t,this._semanticStyling=i,this._provider=r.documentSemanticTokensProvider,this._debounceInformation=s.for(this._provider,"DocumentSemanticTokens",{min:e.REQUEST_MIN_DELAY,max:e.REQUEST_MAX_DELAY}),this._fetchDocumentSemanticTokens=this._register(new g.pY((()=>this._fetchDocumentSemanticTokensNow()),e.REQUEST_MIN_DELAY)),this._currentDocumentResponse=null,this._currentDocumentRequestCancellationTokenSource=null,this._documentProvidersChangeListeners=[],this._register(this._model.onDidChangeContent((()=>{this._fetchDocumentSemanticTokens.isScheduled()||this._fetchDocumentSemanticTokens.schedule(this._debounceInformation.get(this._model))}))),this._register(this._model.onDidChangeLanguage((()=>{this._currentDocumentResponse&&(this._currentDocumentResponse.dispose(),this._currentDocumentResponse=null),this._currentDocumentRequestCancellationTokenSource&&(this._currentDocumentRequestCancellationTokenSource.cancel(),this._currentDocumentRequestCancellationTokenSource=null),this._setDocumentSemanticTokens(null,null,null,[]),this._fetchDocumentSemanticTokens.schedule(0)})));const a=()=>{(0,n.B9)(this._documentProvidersChangeListeners),this._documentProvidersChangeListeners=[];for(const e of this._provider.all(t))"function"==typeof e.onDidChange&&this._documentProvidersChangeListeners.push(e.onDidChange((()=>this._fetchDocumentSemanticTokens.schedule(0))))};a(),this._register(this._provider.onDidChange((()=>{a(),this._fetchDocumentSemanticTokens.schedule(this._debounceInformation.get(this._model))}))),this._register(o.onDidColorThemeChange((e=>{this._setDocumentSemanticTokens(null,null,null,[]),this._fetchDocumentSemanticTokens.schedule(this._debounceInformation.get(this._model))}))),this._fetchDocumentSemanticTokens.schedule(0)}dispose(){this._currentDocumentResponse&&(this._currentDocumentResponse.dispose(),this._currentDocumentResponse=null),this._currentDocumentRequestCancellationTokenSource&&(this._currentDocumentRequestCancellationTokenSource.cancel(),this._currentDocumentRequestCancellationTokenSource=null),this._setDocumentSemanticTokens(null,null,null,[]),this._isDisposed=!0,super.dispose()}_fetchDocumentSemanticTokensNow(){if(this._currentDocumentRequestCancellationTokenSource)return;if(!(0,C.Jc)(this._provider,this._model))return void(this._currentDocumentResponse&&this._model.tokenization.setSemanticTokens(null,!1));const e=new m.A,t=this._currentDocumentResponse?this._currentDocumentResponse.provider:null,i=this._currentDocumentResponse&&this._currentDocumentResponse.resultId||null,o=(0,C.ML)(this._provider,this._model,t,i,e.token);this._currentDocumentRequestCancellationTokenSource=e;const n=[],s=this._model.onDidChangeContent((e=>{n.push(e)})),a=new T.G(!1);o.then((e=>{if(this._debounceInformation.update(this._model,a.elapsed()),this._currentDocumentRequestCancellationTokenSource=null,s.dispose(),e){const{provider:t,tokens:i}=e,o=this._semanticStyling.get(t);this._setDocumentSemanticTokens(t,i||null,o,n)}else this._setDocumentSemanticTokens(null,null,null,n)}),(e=>{e&&(r.n2(e)||"string"==typeof e.message&&-1!==e.message.indexOf("busy"))||r.dL(e),this._currentDocumentRequestCancellationTokenSource=null,s.dispose(),n.length>0&&(this._fetchDocumentSemanticTokens.isScheduled()||this._fetchDocumentSemanticTokens.schedule(this._debounceInformation.get(this._model)))}))}static _copy(e,t,i,o,n){n=Math.min(n,i.length-o,e.length-t);for(let s=0;s<n;s++)i[o+s]=e[t+s]}_setDocumentSemanticTokens(t,i,o,n){const s=this._currentDocumentResponse,r=()=>{n.length>0&&!this._fetchDocumentSemanticTokens.isScheduled()&&this._fetchDocumentSemanticTokens.schedule(this._debounceInformation.get(this._model))};if(this._currentDocumentResponse&&(this._currentDocumentResponse.dispose(),this._currentDocumentResponse=null),this._isDisposed)t&&i&&t.releaseDocumentSemanticTokens(i.resultId);else if(t&&o){if(!i)return this._model.tokenization.setSemanticTokens(null,!0),void r();if((0,C.Vj)(i)){if(!s)return void this._model.tokenization.setSemanticTokens(null,!0);if(0===i.edits.length)i={resultId:i.resultId,data:s.data};else{let t=0;for(const e of i.edits)t+=(e.data?e.data.length:0)-e.deleteCount;const n=s.data,r=new Uint32Array(n.length+t);let a=n.length,d=r.length;for(let t=i.edits.length-1;t>=0;t--){const l=i.edits[t];if(l.start>n.length)return o.warnInvalidEditStart(s.resultId,i.resultId,t,l.start,n.length),void this._model.tokenization.setSemanticTokens(null,!0);const c=a-(l.start+l.deleteCount);c>0&&(e._copy(n,a-c,r,d-c,c),d-=c),l.data&&(e._copy(l.data,0,r,d-l.data.length,l.data.length),d-=l.data.length),a=l.start}a>0&&e._copy(n,0,r,0,a),i={resultId:i.resultId,data:r}}}if((0,C.Vl)(i)){this._currentDocumentResponse=new B(t,i.resultId,i.data);const e=(0,k.h)(i,o,this._model.getLanguageId());if(n.length>0)for(const t of n)for(const i of e)for(const e of t.changes)i.applyEdit(e.range,e.text);this._model.tokenization.setSemanticTokens(e,!0)}else this._model.tokenization.setSemanticTokens(null,!0);r()}else this._model.tokenization.setSemanticTokens(null,!1)}};N.REQUEST_MIN_DELAY=300,N.REQUEST_MAX_DELAY=2e3,N=b([z(2,p.XE),z(3,I.A),z(4,L.p)],N)}}]);