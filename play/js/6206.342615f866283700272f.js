"use strict";(self.webpackChunkapp_template_builder=self.webpackChunkapp_template_builder||[]).push([[6206],{15337:function(t,e,n){n.d(e,{gD:function(){return o}});var i=n(14818),s=n(8964),r=n(41913);class o{constructor(t,e,n,i,s){this.injectionOffsets=t,this.injectionOptions=e,this.breakOffsets=n,this.breakOffsetsVisibleColumn=i,this.wrappedTextIndentLength=s}getOutputLineCount(){return this.breakOffsets.length}getMinOutputOffset(t){return t>0?this.wrappedTextIndentLength:0}getLineLength(t){const e=t>0?this.breakOffsets[t-1]:0;let n=this.breakOffsets[t]-e;return t>0&&(n+=this.wrappedTextIndentLength),n}getMaxOutputOffset(t){return this.getLineLength(t)}translateToInputOffset(t,e){t>0&&(e=Math.max(0,e-this.wrappedTextIndentLength));let n=0===t?e:this.breakOffsets[t-1]+e;if(null!==this.injectionOffsets)for(let t=0;t<this.injectionOffsets.length&&n>this.injectionOffsets[t];t++)n<this.injectionOffsets[t]+this.injectionOptions[t].content.length?n=this.injectionOffsets[t]:n-=this.injectionOptions[t].content.length;return n}translateToOutputPosition(t,e=2){let n=t;if(null!==this.injectionOffsets)for(let i=0;i<this.injectionOffsets.length&&!(t<this.injectionOffsets[i])&&(1===e||t!==this.injectionOffsets[i]);i++)n+=this.injectionOptions[i].content.length;return this.offsetInInputWithInjectionsToOutputPosition(n,e)}offsetInInputWithInjectionsToOutputPosition(t,e=2){let n=0,i=this.breakOffsets.length-1,s=0,r=0;for(;n<=i;){s=n+(i-n)/2|0;const o=this.breakOffsets[s];if(r=s>0?this.breakOffsets[s-1]:0,0===e)if(t<=r)i=s-1;else{if(!(t>o))break;n=s+1}else if(t<r)i=s-1;else{if(!(t>=o))break;n=s+1}}let o=t-r;return s>0&&(o+=this.wrappedTextIndentLength),new c(s,o)}normalizeOutputPosition(t,e,n){if(null!==this.injectionOffsets){const i=this.outputPositionToOffsetInInputWithInjections(t,e),s=this.normalizeOffsetInInputWithInjectionsAroundInjections(i,n);if(s!==i)return this.offsetInInputWithInjectionsToOutputPosition(s,n)}if(0===n){if(t>0&&e===this.getMinOutputOffset(t))return new c(t-1,this.getMaxOutputOffset(t-1))}else if(1===n){if(t<this.getOutputLineCount()-1&&e===this.getMaxOutputOffset(t))return new c(t+1,this.getMinOutputOffset(t+1))}return new c(t,e)}outputPositionToOffsetInInputWithInjections(t,e){t>0&&(e=Math.max(0,e-this.wrappedTextIndentLength));return(t>0?this.breakOffsets[t-1]:0)+e}normalizeOffsetInInputWithInjectionsAroundInjections(t,e){const n=this.getInjectedTextAtOffset(t);if(!n)return t;if(2===e){if(t===n.offsetInInputWithInjections+n.length&&a(this.injectionOptions[n.injectedTextIndex].cursorStops))return n.offsetInInputWithInjections+n.length;{let t=n.offsetInInputWithInjections;if(u(this.injectionOptions[n.injectedTextIndex].cursorStops))return t;let e=n.injectedTextIndex-1;for(;e>=0&&this.injectionOffsets[e]===this.injectionOffsets[n.injectedTextIndex]&&!a(this.injectionOptions[e].cursorStops)&&(t-=this.injectionOptions[e].content.length,!u(this.injectionOptions[e].cursorStops));)e--;return t}}if(1===e||4===e){let t=n.offsetInInputWithInjections+n.length,e=n.injectedTextIndex;for(;e+1<this.injectionOffsets.length&&this.injectionOffsets[e+1]===this.injectionOffsets[e];)t+=this.injectionOptions[e+1].content.length,e++;return t}if(0===e||3===e){let t=n.offsetInInputWithInjections,e=n.injectedTextIndex;for(;e-1>=0&&this.injectionOffsets[e-1]===this.injectionOffsets[e];)t-=this.injectionOptions[e-1].content.length,e--;return t}(0,i.vE)(e)}getInjectedText(t,e){const n=this.outputPositionToOffsetInInputWithInjections(t,e),i=this.getInjectedTextAtOffset(n);return i?{options:this.injectionOptions[i.injectedTextIndex]}:null}getInjectedTextAtOffset(t){const e=this.injectionOffsets,n=this.injectionOptions;if(null!==e){let i=0;for(let s=0;s<e.length;s++){const r=n[s].content.length,o=e[s]+i,a=e[s]+i+r;if(o>t)break;if(t<=a)return{injectedTextIndex:s,offsetInInputWithInjections:o,length:r};i+=r}}}}function a(t){return null==t||(t===r.RM.Right||t===r.RM.Both)}function u(t){return null==t||(t===r.RM.Left||t===r.RM.Both)}class c{constructor(t,e){this.outputLineIndex=t,this.outputOffset=e}toString(){return`${this.outputLineIndex}:${this.outputOffset}`}toPosition(t){return new s.L(t+this.outputLineIndex,this.outputOffset+1)}}},79038:function(t,e,n){n.d(e,{Q:function(){return f}});var i=n(56709),s=n(38431),r=n(50038),o=n(6432),a=n(23189),u=n(16673),c=n(16308);class f extends s.JT{constructor(t,e){super(),this.textModel=t,this.languageConfigurationService=e,this.bracketPairsTree=this._register(new s.XK),this.onDidChangeEmitter=new i.Q5,this.onDidChange=this.onDidChangeEmitter.event,this.bracketsRequested=!1,this._register(this.languageConfigurationService.onDidChange((t=>{var e;t.languageId&&!(null===(e=this.bracketPairsTree.value)||void 0===e?void 0:e.object.didLanguageChange(t.languageId))||(this.bracketPairsTree.clear(),this.updateBracketPairsTree())})))}get canBuildAST(){return this.textModel.getValueLength()<=5e6}handleDidChangeOptions(t){this.bracketPairsTree.clear(),this.updateBracketPairsTree()}handleDidChangeLanguage(t){this.bracketPairsTree.clear(),this.updateBracketPairsTree()}handleDidChangeContent(t){var e;null===(e=this.bracketPairsTree.value)||void 0===e||e.object.handleContentChanged(t)}handleDidChangeBackgroundTokenizationState(){var t;null===(t=this.bracketPairsTree.value)||void 0===t||t.object.handleDidChangeBackgroundTokenizationState()}handleDidChangeTokens(t){var e;null===(e=this.bracketPairsTree.value)||void 0===e||e.object.handleDidChangeTokens(t)}updateBracketPairsTree(){if(this.bracketsRequested&&this.canBuildAST){if(!this.bracketPairsTree.value){const n=new s.SL;this.bracketPairsTree.value=(t=n.add(new o.W(this.textModel,(t=>this.languageConfigurationService.getLanguageConfiguration(t)))),e=n,{object:t,dispose:()=>null==e?void 0:e.dispose()}),n.add(this.bracketPairsTree.value.object.onDidChange((t=>this.onDidChangeEmitter.fire(t)))),this.onDidChangeEmitter.fire()}}else this.bracketPairsTree.value&&(this.bracketPairsTree.clear(),this.onDidChangeEmitter.fire());var t,e}getBracketPairsInRange(t){var e;return this.bracketsRequested=!0,this.updateBracketPairsTree(),(null===(e=this.bracketPairsTree.value)||void 0===e?void 0:e.object.getBracketPairsInRange(t,!1))||[]}getBracketPairsInRangeWithMinIndentation(t){var e;return this.bracketsRequested=!0,this.updateBracketPairsTree(),(null===(e=this.bracketPairsTree.value)||void 0===e?void 0:e.object.getBracketPairsInRange(t,!0))||[]}getBracketsInRange(t){var e;return this.bracketsRequested=!0,this.updateBracketPairsTree(),(null===(e=this.bracketPairsTree.value)||void 0===e?void 0:e.object.getBracketsInRange(t))||[]}findMatchingBracketUp(t,e,n){const i=this.textModel.validatePosition(e),s=this.textModel.getLanguageIdAtPosition(i.lineNumber,i.column);if(this.canBuildAST){const n=this.languageConfigurationService.getLanguageConfiguration(s).bracketsNew.getClosingBracketInfo(t);if(!n)return null;const i=(0,c.dF)(this.getBracketPairsInRange(r.e.fromPositions(e,e))||[],(t=>n.closes(t.openingBracketInfo)));return i?i.openingBracketRange:null}{const e=t.toLowerCase(),r=this.languageConfigurationService.getLanguageConfiguration(s).brackets;if(!r)return null;const o=r.textIsBracket[e];return o?h(this._findMatchingBracketUp(o,i,g(n))):null}}matchBracket(t,e){if(this.canBuildAST){const e=(0,c.jV)(this.getBracketPairsInRange(r.e.fromPositions(t,t)).filter((e=>void 0!==e.closingBracketRange&&(e.openingBracketRange.containsPosition(t)||e.closingBracketRange.containsPosition(t)))),(0,c.tT)((e=>e.openingBracketRange.containsPosition(t)?e.openingBracketRange:e.closingBracketRange),r.e.compareRangesUsingStarts));return e?[e.openingBracketRange,e.closingBracketRange]:null}{const n=g(e);return this._matchBracket(this.textModel.validatePosition(t),n)}}_establishBracketSearchOffsets(t,e,n,i){const s=e.getCount(),r=e.getLanguageId(i);let o=Math.max(0,t.column-1-n.maxBracketLength);for(let t=i-1;t>=0;t--){const n=e.getEndOffset(t);if(n<=o)break;if((0,a.Bu)(e.getStandardTokenType(t))||e.getLanguageId(t)!==r){o=n;break}}let u=Math.min(e.getLineContent().length,t.column-1+n.maxBracketLength);for(let t=i+1;t<s;t++){const n=e.getStartOffset(t);if(n>=u)break;if((0,a.Bu)(e.getStandardTokenType(t))||e.getLanguageId(t)!==r){u=n;break}}return{searchStartOffset:o,searchEndOffset:u}}_matchBracket(t,e){const n=t.lineNumber,i=this.textModel.tokenization.getLineTokens(n),s=this.textModel.getLineContent(n),r=i.findTokenIndexAtOffset(t.column-1);if(r<0)return null;const o=this.languageConfigurationService.getLanguageConfiguration(i.getLanguageId(r)).brackets;if(o&&!(0,a.Bu)(i.getStandardTokenType(r))){let{searchStartOffset:a,searchEndOffset:c}=this._establishBracketSearchOffsets(t,i,o,r),f=null;for(;;){const i=u.Vr.findNextBracketInRange(o.forwardRegex,n,s,a,c);if(!i)break;if(i.startColumn<=t.column&&t.column<=i.endColumn){const t=s.substring(i.startColumn-1,i.endColumn-1).toLowerCase(),n=this._matchFoundBracket(i,o.textIsBracket[t],o.textIsOpenBracket[t],e);if(n){if(n instanceof l)return null;f=n}}a=i.endColumn-1}if(f)return f}if(r>0&&i.getStartOffset(r)===t.column-1){const o=r-1,c=this.languageConfigurationService.getLanguageConfiguration(i.getLanguageId(o)).brackets;if(c&&!(0,a.Bu)(i.getStandardTokenType(o))){const{searchStartOffset:r,searchEndOffset:a}=this._establishBracketSearchOffsets(t,i,c,o),f=u.Vr.findPrevBracketInRange(c.reversedRegex,n,s,r,a);if(f&&f.startColumn<=t.column&&t.column<=f.endColumn){const t=s.substring(f.startColumn-1,f.endColumn-1).toLowerCase(),n=this._matchFoundBracket(f,c.textIsBracket[t],c.textIsOpenBracket[t],e);if(n)return n instanceof l?null:n}}}return null}_matchFoundBracket(t,e,n,i){if(!e)return null;const s=n?this._findMatchingBracketDown(e,t.getEndPosition(),i):this._findMatchingBracketUp(e,t.getStartPosition(),i);return s?s instanceof l?s:[t,s]:null}_findMatchingBracketUp(t,e,n){const i=t.languageId,s=t.reversedRegex;let r=-1,o=0;const c=(e,i,a,c)=>{for(;;){if(n&&++o%100==0&&!n())return l.INSTANCE;const f=u.Vr.findPrevBracketInRange(s,e,i,a,c);if(!f)break;const g=i.substring(f.startColumn-1,f.endColumn-1).toLowerCase();if(t.isOpen(g)?r++:t.isClose(g)&&r--,0===r)return f;c=f.startColumn-1}return null};for(let t=e.lineNumber;t>=1;t--){const n=this.textModel.tokenization.getLineTokens(t),s=n.getCount(),r=this.textModel.getLineContent(t);let o=s-1,u=r.length,f=r.length;t===e.lineNumber&&(o=n.findTokenIndexAtOffset(e.column-1),u=e.column-1,f=e.column-1);let g=!0;for(;o>=0;o--){const e=n.getLanguageId(o)===i&&!(0,a.Bu)(n.getStandardTokenType(o));if(e)g?u=n.getStartOffset(o):(u=n.getStartOffset(o),f=n.getEndOffset(o));else if(g&&u!==f){const e=c(t,r,u,f);if(e)return e}g=e}if(g&&u!==f){const e=c(t,r,u,f);if(e)return e}}return null}_findMatchingBracketDown(t,e,n){const i=t.languageId,s=t.forwardRegex;let r=1,o=0;const c=(e,i,a,c)=>{for(;;){if(n&&++o%100==0&&!n())return l.INSTANCE;const f=u.Vr.findNextBracketInRange(s,e,i,a,c);if(!f)break;const g=i.substring(f.startColumn-1,f.endColumn-1).toLowerCase();if(t.isOpen(g)?r++:t.isClose(g)&&r--,0===r)return f;a=f.endColumn-1}return null},f=this.textModel.getLineCount();for(let t=e.lineNumber;t<=f;t++){const n=this.textModel.tokenization.getLineTokens(t),s=n.getCount(),r=this.textModel.getLineContent(t);let o=0,u=0,f=0;t===e.lineNumber&&(o=n.findTokenIndexAtOffset(e.column-1),u=e.column-1,f=e.column-1);let g=!0;for(;o<s;o++){const e=n.getLanguageId(o)===i&&!(0,a.Bu)(n.getStandardTokenType(o));if(e)g||(u=n.getStartOffset(o)),f=n.getEndOffset(o);else if(g&&u!==f){const e=c(t,r,u,f);if(e)return e}g=e}if(g&&u!==f){const e=c(t,r,u,f);if(e)return e}}return null}findPrevBracket(t){var e;const n=this.textModel.validatePosition(t);if(this.canBuildAST)return this.bracketsRequested=!0,this.updateBracketPairsTree(),(null===(e=this.bracketPairsTree.value)||void 0===e?void 0:e.object.getFirstBracketBefore(n))||null;let i=null,s=null,r=null;for(let t=n.lineNumber;t>=1;t--){const e=this.textModel.tokenization.getLineTokens(t),o=e.getCount(),c=this.textModel.getLineContent(t);let f=o-1,g=c.length,l=c.length;if(t===n.lineNumber){f=e.findTokenIndexAtOffset(n.column-1),g=n.column-1,l=n.column-1;const t=e.getLanguageId(f);i!==t&&(i=t,s=this.languageConfigurationService.getLanguageConfiguration(i).brackets,r=this.languageConfigurationService.getLanguageConfiguration(i).bracketsNew)}let h=!0;for(;f>=0;f--){const n=e.getLanguageId(f);if(i!==n){if(s&&r&&h&&g!==l){const e=u.Vr.findPrevBracketInRange(s.reversedRegex,t,c,g,l);if(e)return this._toFoundBracket(r,e);h=!1}i=n,s=this.languageConfigurationService.getLanguageConfiguration(i).brackets,r=this.languageConfigurationService.getLanguageConfiguration(i).bracketsNew}const o=!!s&&!(0,a.Bu)(e.getStandardTokenType(f));if(o)h?g=e.getStartOffset(f):(g=e.getStartOffset(f),l=e.getEndOffset(f));else if(r&&s&&h&&g!==l){const e=u.Vr.findPrevBracketInRange(s.reversedRegex,t,c,g,l);if(e)return this._toFoundBracket(r,e)}h=o}if(r&&s&&h&&g!==l){const e=u.Vr.findPrevBracketInRange(s.reversedRegex,t,c,g,l);if(e)return this._toFoundBracket(r,e)}}return null}findNextBracket(t){var e;const n=this.textModel.validatePosition(t);if(this.canBuildAST)return this.bracketsRequested=!0,this.updateBracketPairsTree(),(null===(e=this.bracketPairsTree.value)||void 0===e?void 0:e.object.getFirstBracketAfter(n))||null;const i=this.textModel.getLineCount();let s=null,r=null,o=null;for(let t=n.lineNumber;t<=i;t++){const e=this.textModel.tokenization.getLineTokens(t),i=e.getCount(),c=this.textModel.getLineContent(t);let f=0,g=0,l=0;if(t===n.lineNumber){f=e.findTokenIndexAtOffset(n.column-1),g=n.column-1,l=n.column-1;const t=e.getLanguageId(f);s!==t&&(s=t,r=this.languageConfigurationService.getLanguageConfiguration(s).brackets,o=this.languageConfigurationService.getLanguageConfiguration(s).bracketsNew)}let h=!0;for(;f<i;f++){const n=e.getLanguageId(f);if(s!==n){if(o&&r&&h&&g!==l){const e=u.Vr.findNextBracketInRange(r.forwardRegex,t,c,g,l);if(e)return this._toFoundBracket(o,e);h=!1}s=n,r=this.languageConfigurationService.getLanguageConfiguration(s).brackets,o=this.languageConfigurationService.getLanguageConfiguration(s).bracketsNew}const i=!!r&&!(0,a.Bu)(e.getStandardTokenType(f));if(i)h||(g=e.getStartOffset(f)),l=e.getEndOffset(f);else if(o&&r&&h&&g!==l){const e=u.Vr.findNextBracketInRange(r.forwardRegex,t,c,g,l);if(e)return this._toFoundBracket(o,e)}h=i}if(o&&r&&h&&g!==l){const e=u.Vr.findNextBracketInRange(r.forwardRegex,t,c,g,l);if(e)return this._toFoundBracket(o,e)}}return null}findEnclosingBrackets(t,e){const n=this.textModel.validatePosition(t);if(this.canBuildAST){const t=r.e.fromPositions(n),e=(0,c.dF)(this.getBracketPairsInRange(r.e.fromPositions(n,n)),(e=>void 0!==e.closingBracketRange&&e.range.strictContainsRange(t)));return e?[e.openingBracketRange,e.closingBracketRange]:null}const i=g(e),s=this.textModel.getLineCount(),o=new Map;let f=[];const d=(t,e)=>{if(!o.has(t)){const n=[];for(let t=0,i=e?e.brackets.length:0;t<i;t++)n[t]=0;o.set(t,n)}f=o.get(t)};let k=0;const I=(t,e,n,s,r)=>{for(;;){if(i&&++k%100==0&&!i())return l.INSTANCE;const o=u.Vr.findNextBracketInRange(t.forwardRegex,e,n,s,r);if(!o)break;const a=n.substring(o.startColumn-1,o.endColumn-1).toLowerCase(),c=t.textIsBracket[a];if(c&&(c.isOpen(a)?f[c.index]++:c.isClose(a)&&f[c.index]--,-1===f[c.index]))return this._matchFoundBracket(o,c,!1,i);s=o.endColumn-1}return null};let p=null,O=null;for(let t=n.lineNumber;t<=s;t++){const e=this.textModel.tokenization.getLineTokens(t),i=e.getCount(),s=this.textModel.getLineContent(t);let r=0,o=0,u=0;if(t===n.lineNumber){r=e.findTokenIndexAtOffset(n.column-1),o=n.column-1,u=n.column-1;const t=e.getLanguageId(r);p!==t&&(p=t,O=this.languageConfigurationService.getLanguageConfiguration(p).brackets,d(p,O))}let c=!0;for(;r<i;r++){const n=e.getLanguageId(r);if(p!==n){if(O&&c&&o!==u){const e=I(O,t,s,o,u);if(e)return h(e);c=!1}p=n,O=this.languageConfigurationService.getLanguageConfiguration(p).brackets,d(p,O)}const i=!!O&&!(0,a.Bu)(e.getStandardTokenType(r));if(i)c||(o=e.getStartOffset(r)),u=e.getEndOffset(r);else if(O&&c&&o!==u){const e=I(O,t,s,o,u);if(e)return h(e)}c=i}if(O&&c&&o!==u){const e=I(O,t,s,o,u);if(e)return h(e)}}return null}_toFoundBracket(t,e){if(!e)return null;let n=this.textModel.getValueInRange(e);n=n.toLowerCase();const i=t.getBracketInfo(n);return i?{range:e,bracketInfo:i}:null}}function g(t){if(void 0===t)return()=>!0;{const e=Date.now();return()=>Date.now()-e<=t}}class l{constructor(){this._searchCanceledBrand=void 0}}function h(t){return t instanceof l?null:t}l.INSTANCE=new l}}]);