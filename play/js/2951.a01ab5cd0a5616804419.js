"use strict";(self.webpackChunkapp_template_builder=self.webpackChunkapp_template_builder||[]).push([[2951],{52664:function(t,e,o){o.r(e),o.d(e,{ColorContribution:function(){return W}});var i=o(38431),r=o(55298),s=o(50038),n=o(13484),a=o(86741),h=o(20996),l=o(69344),d=o(17416),c=o(31396),u=o(132),g=o(69060),p=o(35921),C=o(97464),m=o(28919),_=o(65041),f=o(80793);function D(t,e,o,i){return Promise.resolve(o.provideColorPresentations(t,e,i))}f.P0.registerCommand("_executeDocumentColorProvider",(function(t,...e){const[o]=e;if(!(o instanceof m.o))throw(0,h.b1)();const{colorProvider:i}=t.get(p.p),r=t.get(_.q).getModel(o);if(!r)throw(0,h.b1)();const s=[],n=i.ordered(r).reverse().map((t=>Promise.resolve(t.provideDocumentColors(r,C.T.None)).then((t=>{if(Array.isArray(t))for(const e of t)s.push({range:e.range,color:[e.color.red,e.color.green,e.color.blue,e.color.alpha]})}))));return Promise.all(n).then((()=>s))})),f.P0.registerCommand("_executeColorPresentationProvider",(function(t,...e){const[o,i]=e,{uri:r,range:n}=i;if(!(r instanceof m.o&&Array.isArray(o)&&4===o.length&&s.e.isIRange(n)))throw(0,h.b1)();const[a,l,d,c]=o,{colorProvider:u}=t.get(p.p),g=t.get(_.q).getModel(r);if(!g)throw(0,h.b1)();const f={range:n,color:{red:a,green:l,blue:d,alpha:c}},D=[],b=u.ordered(g).reverse().map((t=>Promise.resolve(t.provideColorPresentations(g,f,C.T.None)).then((t=>{Array.isArray(t)&&D.push(...t)}))));return Promise.all(b).then((()=>D))}));var b=o(71177),v=function(t,e,o,i){var r,s=arguments.length,n=s<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(t,e,o,i);else for(var a=t.length-1;a>=0;a--)(r=t[a])&&(n=(s<3?r(n):s>3?r(e,o,n):r(e,o))||n);return s>3&&n&&Object.defineProperty(e,o,n),n},P=function(t,e){return function(o,i){e(o,i,t)}},w=function(t,e,o,i){return new(o||(o=Promise))((function(r,s){function n(t){try{h(i.next(t))}catch(t){s(t)}}function a(t){try{h(i.throw(t))}catch(t){s(t)}}function h(t){var e;t.done?r(t.value):(e=t.value,e instanceof o?e:new o((function(t){t(e)}))).then(n,a)}h((i=i.apply(t,e||[])).next())}))};const y=Object.create({});let N=class t extends i.JT{constructor(e,o,r,s){super(),this._editor=e,this._configurationService=o,this._languageFeaturesService=r,this._localToDispose=this._register(new i.SL),this._decorationsIds=[],this._colorDatas=new Map,this._colorDecoratorIds=this._editor.createDecorationsCollection(),this._ruleFactory=new c.t7(this._editor),this._colorDecorationClassRefs=this._register(new i.SL),this._debounceInformation=s.for(r.colorProvider,"Document Colors",{min:t.RECOMPUTE_TIME}),this._register(e.onDidChangeModel((()=>{this._isEnabled=this.isEnabled(),this.onModelChanged()}))),this._register(e.onDidChangeModelLanguage((()=>this.onModelChanged()))),this._register(r.colorProvider.onDidChange((()=>this.onModelChanged()))),this._register(e.onDidChangeConfiguration((()=>{const t=this._isEnabled;this._isEnabled=this.isEnabled(),t!==this._isEnabled&&(this._isEnabled?this.onModelChanged():this.removeAllDecorations())}))),this._timeoutTimer=null,this._computePromise=null,this._isEnabled=this.isEnabled(),this.onModelChanged()}isEnabled(){const t=this._editor.getModel();if(!t)return!1;const e=t.getLanguageId(),o=this._configurationService.getValue(e);if(o&&"object"==typeof o){const t=o.colorDecorators;if(t&&void 0!==t.enable&&!t.enable)return t.enable}return this._editor.getOption(17)}static get(t){return t.getContribution(this.ID)}dispose(){this.stop(),this.removeAllDecorations(),super.dispose()}onModelChanged(){if(this.stop(),!this._isEnabled)return;const t=this._editor.getModel();t&&this._languageFeaturesService.colorProvider.has(t)&&(this._localToDispose.add(this._editor.onDidChangeModelContent((()=>{this._timeoutTimer||(this._timeoutTimer=new n._F,this._timeoutTimer.cancelAndSet((()=>{this._timeoutTimer=null,this.beginCompute()}),this._debounceInformation.get(t)))}))),this.beginCompute())}beginCompute(){this._computePromise=(0,n.PG)((t=>w(this,void 0,void 0,(function*(){const e=this._editor.getModel();if(!e)return Promise.resolve([]);const o=new l.G(!1),i=yield function(t,e,o){const i=[],r=t.ordered(e).reverse().map((t=>Promise.resolve(t.provideDocumentColors(e,o)).then((e=>{if(Array.isArray(e))for(const o of e)i.push({colorInfo:o,provider:t})}))));return Promise.all(r).then((()=>i))}(this._languageFeaturesService.colorProvider,e,t);return this._debounceInformation.update(e,o.elapsed()),i})))),this._computePromise.then((t=>{this.updateDecorations(t),this.updateColorDecorators(t),this._computePromise=null}),h.dL)}stop(){this._timeoutTimer&&(this._timeoutTimer.cancel(),this._timeoutTimer=null),this._computePromise&&(this._computePromise.cancel(),this._computePromise=null),this._localToDispose.clear()}updateDecorations(t){const e=t.map((t=>({range:{startLineNumber:t.colorInfo.range.startLineNumber,startColumn:t.colorInfo.range.startColumn,endLineNumber:t.colorInfo.range.endLineNumber,endColumn:t.colorInfo.range.endColumn},options:u.qx.EMPTY})));this._editor.changeDecorations((o=>{this._decorationsIds=o.deltaDecorations(this._decorationsIds,e),this._colorDatas=new Map,this._decorationsIds.forEach(((e,o)=>this._colorDatas.set(e,t[o])))}))}updateColorDecorators(t){this._colorDecorationClassRefs.clear();const e=[];for(let o=0;o<t.length&&e.length<500;o++){const{red:i,green:r,blue:s,alpha:n}=t[o].colorInfo.color,h=new a.VS(Math.round(255*i),Math.round(255*r),Math.round(255*s),n),l=`rgba(${h.r}, ${h.g}, ${h.b}, ${h.a})`,c=this._colorDecorationClassRefs.add(this._ruleFactory.createClassNameRef({backgroundColor:l}));e.push({range:{startLineNumber:t[o].colorInfo.range.startLineNumber,startColumn:t[o].colorInfo.range.startColumn,endLineNumber:t[o].colorInfo.range.endLineNumber,endColumn:t[o].colorInfo.range.endColumn},options:{description:"colorDetector",before:{content:d.B4,inlineClassName:`${c.className} colorpicker-color-decoration`,inlineClassNameAffectsLetterSpacing:!0,attachedData:y}}})}this._colorDecoratorIds.set(e)}removeAllDecorations(){this._editor.removeDecorations(this._decorationsIds),this._decorationsIds=[],this._colorDecoratorIds.clear(),this._colorDecorationClassRefs.clear()}getColorData(t){const e=this._editor.getModel();if(!e)return null;const o=e.getDecorationsInRange(s.e.fromPositions(t,t)).filter((t=>this._colorDatas.has(t.id)));return 0===o.length?null:this._colorDatas.get(o[0].id)}isColorDecoration(t){return this._colorDecoratorIds.has(t)}};N.ID="editor.contrib.colorDetector",N.RECOMPUTE_TIME=1e3,N=v([P(1,b.Ui),P(2,p.p),P(3,g.A)],N),(0,r._K)(N.ID,N);var x=o(56709);class I{constructor(t,e,o){this.presentationIndex=o,this._onColorFlushed=new x.Q5,this.onColorFlushed=this._onColorFlushed.event,this._onDidChangeColor=new x.Q5,this.onDidChangeColor=this._onDidChangeColor.event,this._onDidChangePresentation=new x.Q5,this.onDidChangePresentation=this._onDidChangePresentation.event,this.originalColor=t,this._color=t,this._colorPresentations=e}get color(){return this._color}set color(t){this._color.equals(t)||(this._color=t,this._onDidChangeColor.fire(t))}get presentation(){return this.colorPresentations[this.presentationIndex]}get colorPresentations(){return this._colorPresentations}set colorPresentations(t){this._colorPresentations=t,this.presentationIndex>t.length-1&&(this.presentationIndex=0),this._onDidChangePresentation.fire(this.presentation)}selectNextColorPresentation(){this.presentationIndex=(this.presentationIndex+1)%this.colorPresentations.length,this.flushColor(),this._onDidChangePresentation.fire(this.presentation)}guessColorPresentation(t,e){for(let t=0;t<this.colorPresentations.length;t++)if(e.toLowerCase()===this.colorPresentations[t].label){this.presentationIndex=t,this._onDidChangePresentation.fire(this.presentation);break}}flushColor(){this._onColorFlushed.fire(this._color)}}var S=o(71488),M=o(34441),T=o(97314),R=o(88305),E=o(26386),k=o(92537),L=o(58566);const F=M.$;class A extends i.JT{constructor(t,e,o){super(),this.model=e,this.domNode=F(".colorpicker-header"),M.R3(t,this.domNode),this.pickedColorNode=M.R3(this.domNode,F(".picked-color"));const i=(0,E.NC)("clickToToggleColorOptions","Click to toggle color options (rgb/hsl/hex)");this.pickedColorNode.setAttribute("title",i);const r=M.R3(this.domNode,F(".original-color"));r.style.backgroundColor=a.Il.Format.CSS.format(this.model.originalColor)||"",this.backgroundColor=o.getColorTheme().getColor(k.yJx)||a.Il.white,this._register((0,L.Ic)(((t,e)=>{this.backgroundColor=t.getColor(k.yJx)||a.Il.white}))),this._register(M.nm(this.pickedColorNode,M.tw.CLICK,(()=>this.model.selectNextColorPresentation()))),this._register(M.nm(r,M.tw.CLICK,(()=>{this.model.color=this.model.originalColor,this.model.flushColor()}))),this._register(e.onDidChangeColor(this.onDidChangeColor,this)),this._register(e.onDidChangePresentation(this.onDidChangePresentation,this)),this.pickedColorNode.style.backgroundColor=a.Il.Format.CSS.format(e.color)||"",this.pickedColorNode.classList.toggle("light",e.color.rgba.a<.5?this.backgroundColor.isLighter():e.color.isLighter()),this.onDidChangeColor(this.model.color)}onDidChangeColor(t){this.pickedColorNode.style.backgroundColor=a.Il.Format.CSS.format(t)||"",this.pickedColorNode.classList.toggle("light",t.rgba.a<.5?this.backgroundColor.isLighter():t.isLighter()),this.onDidChangePresentation()}onDidChangePresentation(){this.pickedColorNode.textContent=this.model.presentation?this.model.presentation.label:"",this.pickedColorNode.prepend(F(".codicon.codicon-color-mode"))}}class O extends i.JT{constructor(t,e,o){super(),this.model=e,this.pixelRatio=o,this.domNode=F(".colorpicker-body"),M.R3(t,this.domNode),this.saturationBox=new V(this.domNode,this.model,this.pixelRatio),this._register(this.saturationBox),this._register(this.saturationBox.onDidChange(this.onDidSaturationValueChange,this)),this._register(this.saturationBox.onColorFlushed(this.flushColor,this)),this.opacityStrip=new j(this.domNode,this.model),this._register(this.opacityStrip),this._register(this.opacityStrip.onDidChange(this.onDidOpacityChange,this)),this._register(this.opacityStrip.onColorFlushed(this.flushColor,this)),this.hueStrip=new J(this.domNode,this.model),this._register(this.hueStrip),this._register(this.hueStrip.onDidChange(this.onDidHueChange,this)),this._register(this.hueStrip.onColorFlushed(this.flushColor,this))}flushColor(){this.model.flushColor()}onDidSaturationValueChange({s:t,v:e}){const o=this.model.color.hsva;this.model.color=new a.Il(new a.tx(o.h,t,e,o.a))}onDidOpacityChange(t){const e=this.model.color.hsva;this.model.color=new a.Il(new a.tx(e.h,e.s,e.v,t))}onDidHueChange(t){const e=this.model.color.hsva,o=360*(1-t);this.model.color=new a.Il(new a.tx(360===o?0:o,e.s,e.v,e.a))}layout(){this.saturationBox.layout(),this.opacityStrip.layout(),this.hueStrip.layout()}}class V extends i.JT{constructor(t,e,o){super(),this.model=e,this.pixelRatio=o,this._onDidChange=new x.Q5,this.onDidChange=this._onDidChange.event,this._onColorFlushed=new x.Q5,this.onColorFlushed=this._onColorFlushed.event,this.domNode=F(".saturation-wrap"),M.R3(t,this.domNode),this.canvas=document.createElement("canvas"),this.canvas.className="saturation-box",M.R3(this.domNode,this.canvas),this.selection=F(".saturation-selection"),M.R3(this.domNode,this.selection),this.layout(),this._register(M.nm(this.domNode,M.tw.POINTER_DOWN,(t=>this.onPointerDown(t)))),this._register(this.model.onDidChangeColor(this.onDidChangeColor,this)),this.monitor=null}onPointerDown(t){if(!(t.target&&t.target instanceof Element))return;this.monitor=this._register(new T.C);const e=M.i(this.domNode);t.target!==this.selection&&this.onDidChangePosition(t.offsetX,t.offsetY),this.monitor.startMonitoring(t.target,t.pointerId,t.buttons,(t=>this.onDidChangePosition(t.pageX-e.left,t.pageY-e.top)),(()=>null));const o=M.nm(document,M.tw.POINTER_UP,(()=>{this._onColorFlushed.fire(),o.dispose(),this.monitor&&(this.monitor.stopMonitoring(!0),this.monitor=null)}),!0)}onDidChangePosition(t,e){const o=Math.max(0,Math.min(1,t/this.width)),i=Math.max(0,Math.min(1,1-e/this.height));this.paintSelection(o,i),this._onDidChange.fire({s:o,v:i})}layout(){this.width=this.domNode.offsetWidth,this.height=this.domNode.offsetHeight,this.canvas.width=this.width*this.pixelRatio,this.canvas.height=this.height*this.pixelRatio,this.paint();const t=this.model.color.hsva;this.paintSelection(t.s,t.v)}paint(){const t=this.model.color.hsva,e=new a.Il(new a.tx(t.h,1,1,1)),o=this.canvas.getContext("2d"),i=o.createLinearGradient(0,0,this.canvas.width,0);i.addColorStop(0,"rgba(255, 255, 255, 1)"),i.addColorStop(.5,"rgba(255, 255, 255, 0.5)"),i.addColorStop(1,"rgba(255, 255, 255, 0)");const r=o.createLinearGradient(0,0,0,this.canvas.height);r.addColorStop(0,"rgba(0, 0, 0, 0)"),r.addColorStop(1,"rgba(0, 0, 0, 1)"),o.rect(0,0,this.canvas.width,this.canvas.height),o.fillStyle=a.Il.Format.CSS.format(e),o.fill(),o.fillStyle=i,o.fill(),o.fillStyle=r,o.fill()}paintSelection(t,e){this.selection.style.left=t*this.width+"px",this.selection.style.top=this.height-e*this.height+"px"}onDidChangeColor(){this.monitor&&this.monitor.isMonitoring()||this.paint()}}class H extends i.JT{constructor(t,e){super(),this.model=e,this._onDidChange=new x.Q5,this.onDidChange=this._onDidChange.event,this._onColorFlushed=new x.Q5,this.onColorFlushed=this._onColorFlushed.event,this.domNode=M.R3(t,F(".strip")),this.overlay=M.R3(this.domNode,F(".overlay")),this.slider=M.R3(this.domNode,F(".slider")),this.slider.style.top="0px",this._register(M.nm(this.domNode,M.tw.POINTER_DOWN,(t=>this.onPointerDown(t)))),this.layout()}layout(){this.height=this.domNode.offsetHeight-this.slider.offsetHeight;const t=this.getValue(this.model.color);this.updateSliderPosition(t)}onPointerDown(t){if(!(t.target&&t.target instanceof Element))return;const e=this._register(new T.C),o=M.i(this.domNode);this.domNode.classList.add("grabbing"),t.target!==this.slider&&this.onDidChangeTop(t.offsetY),e.startMonitoring(t.target,t.pointerId,t.buttons,(t=>this.onDidChangeTop(t.pageY-o.top)),(()=>null));const i=M.nm(document,M.tw.POINTER_UP,(()=>{this._onColorFlushed.fire(),i.dispose(),e.stopMonitoring(!0),this.domNode.classList.remove("grabbing")}),!0)}onDidChangeTop(t){const e=Math.max(0,Math.min(1,1-t/this.height));this.updateSliderPosition(e),this._onDidChange.fire(e)}updateSliderPosition(t){this.slider.style.top=(1-t)*this.height+"px"}}class j extends H{constructor(t,e){super(t,e),this.domNode.classList.add("opacity-strip"),this._register(e.onDidChangeColor(this.onDidChangeColor,this)),this.onDidChangeColor(this.model.color)}onDidChangeColor(t){const{r:e,g:o,b:i}=t.rgba,r=new a.Il(new a.VS(e,o,i,1)),s=new a.Il(new a.VS(e,o,i,0));this.overlay.style.background=`linear-gradient(to bottom, ${r} 0%, ${s} 100%)`}getValue(t){return t.hsva.a}}class J extends H{constructor(t,e){super(t,e),this.domNode.classList.add("hue-strip")}getValue(t){return 1-t.hsva.h/360}}class $ extends R.${constructor(t,e,o,i){super(),this.model=e,this.pixelRatio=o,this._register(S.PixelRatio.onDidChange((()=>this.layout())));const r=F(".colorpicker-widget");t.appendChild(r);const s=new A(r,this.model,i);this.body=new O(r,this.model,this.pixelRatio),this._register(s),this._register(this.body)}layout(){this.body.layout()}}var U=function(t,e,o,i){var r,s=arguments.length,n=s<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(t,e,o,i);else for(var a=t.length-1;a>=0;a--)(r=t[a])&&(n=(s<3?r(n):s>3?r(e,o,n):r(e,o))||n);return s>3&&n&&Object.defineProperty(e,o,n),n},Q=function(t,e){return function(o,i){e(o,i,t)}},B=function(t,e,o,i){return new(o||(o=Promise))((function(r,s){function n(t){try{h(i.next(t))}catch(t){s(t)}}function a(t){try{h(i.throw(t))}catch(t){s(t)}}function h(t){var e;t.done?r(t.value):(e=t.value,e instanceof o?e:new o((function(t){t(e)}))).then(n,a)}h((i=i.apply(t,e||[])).next())}))};class q{constructor(t,e,o,i){this.owner=t,this.range=e,this.model=o,this.provider=i,this.forceShowAtRange=!0}isValidForHoverAnchor(t){return 1===t.type&&this.range.startColumn<=t.range.startColumn&&this.range.endColumn>=t.range.endColumn}}let Y=class{constructor(t,e){this._editor=t,this._themeService=e,this.hoverOrdinal=1}computeSync(t,e){return[]}computeAsync(t,e,o){return n.Aq.fromPromise(this._computeAsync(t,e,o))}_computeAsync(t,e,o){return B(this,void 0,void 0,(function*(){if(!this._editor.hasModel())return[];const t=N.get(this._editor);if(!t)return[];for(const o of e){if(!t.isColorDecoration(o))continue;const e=t.getColorData(o.range.getStartPosition());if(e){return[yield this._createColorHover(this._editor.getModel(),e.colorInfo,e.provider)]}}return[]}))}_createColorHover(t,e,o){return B(this,void 0,void 0,(function*(){const i=t.getValueInRange(e.range),{red:r,green:n,blue:h,alpha:l}=e.color,d=new a.VS(Math.round(255*r),Math.round(255*n),Math.round(255*h),l),c=new a.Il(d),u=yield D(t,e,o,C.T.None),g=new I(c,[],0);return g.colorPresentations=u||[],g.guessColorPresentation(c,i),new q(this,s.e.lift(e.range),g,o)}))}renderHoverParts(t,e){if(0===e.length||!this._editor.hasModel())return i.JT.None;const o=new i.SL,r=e[0],n=this._editor.getModel(),a=r.model,h=o.add(new $(t.fragment,a,this._editor.getOption(131),this._themeService));t.setColorPicker(h);let l=new s.e(r.range.startLineNumber,r.range.startColumn,r.range.endLineNumber,r.range.endColumn);const d=()=>{let e,o;if(a.presentation.textEdit){e=[a.presentation.textEdit],o=new s.e(a.presentation.textEdit.range.startLineNumber,a.presentation.textEdit.range.startColumn,a.presentation.textEdit.range.endLineNumber,a.presentation.textEdit.range.endColumn);const t=this._editor.getModel()._setTrackedRange(null,o,3);this._editor.pushUndoStop(),this._editor.executeEdits("colorpicker",e),o=this._editor.getModel()._getTrackedRange(t)||o}else e=[{range:l,text:a.presentation.label,forceMoveMarkers:!1}],o=l.setEndPosition(l.endLineNumber,l.startColumn+a.presentation.label.length),this._editor.pushUndoStop(),this._editor.executeEdits("colorpicker",e);a.presentation.additionalTextEdits&&(e=[...a.presentation.additionalTextEdits],this._editor.executeEdits("colorpicker",e),t.hide()),this._editor.pushUndoStop(),l=o},c=t=>D(n,{range:l,color:{red:t.rgba.r/255,green:t.rgba.g/255,blue:t.rgba.b/255,alpha:t.rgba.a}},r.provider,C.T.None).then((t=>{a.colorPresentations=t||[]}));return o.add(a.onColorFlushed((t=>{c(t).then(d)}))),o.add(a.onDidChangeColor(c)),o}};Y=U([Q(1,L.XE)],Y);var G=o(90879),K=o(72223);class W extends i.JT{constructor(t){super(),this._editor=t,this._register(t.onMouseDown((t=>this.onMouseDown(t))))}dispose(){super.dispose()}onMouseDown(t){const e=t.target;if(6!==e.type)return;if(!e.detail.injectedText)return;if(e.detail.injectedText.options.attachedData!==y)return;if(!e.range)return;const o=this._editor.getContribution(G.ModesHoverController.ID);if(o&&!o.isColorPickerVisible()){const t=new s.e(e.range.startLineNumber,e.range.startColumn+1,e.range.endLineNumber,e.range.endColumn+1);o.showContentHover(t,1,!1)}}}W.ID="editor.contrib.colorContribution",(0,r._K)(W.ID,W),K.Ae.register(Y)}}]);