"use strict";(self.webpackChunkapp_template_builder=self.webpackChunkapp_template_builder||[]).push([[928],{91286:function(t,e,i){i.d(e,{s:function(){return a}});i(77950),i(85940);var n=i(87263),r=i(27875),a={name:"FormComponentBase",components:{},inject:["onChange","onGetValue","onEvent"],props:{id:{type:String,default:function(){return""}},type:{type:String,default:function(){return""}},extras:{type:Object,default:function(){return{}}},placeholder:{type:String,default:function(){return"请输入"}},rules:{type:Array,default:function(){return[]}},fieldPath:{type:String,default:function(){return""}},componentMap:{type:Object,default:function(){return{}}},formData:{type:Object,default:function(){return{}}}},data:function(){return{}},computed:{value:{get:function(){var t="";return this.formData&&this.fieldPath&&(t=(0,n.g)(this.formData,this.fieldPath)),t},set:function(t){this.onChange(t,this.id)}},validProp:function(){return this.fieldPath.replace(/\//g,".")}},render:function(t,e,i,n,a,s){return(0,r.wg)(),(0,r.iD)("div")}}},6928:function(t,e,i){i.r(e),i.d(e,{default:function(){return c}});i(71245),i(18178),i(43450),i(68995),i(17368),i(77950),i(51172),i(88233),i(48319),i(26936),i(21850),i(9949),i(99805);var n=i(27875),r=i(50349),a=i(91286),s=i(87263),u=(0,n.aZ)({name:"ImageList",extends:a.s,props:{fileList:{type:Array,default:function(){return[]}},width:{type:Number,default:function(){return 50}},height:{type:Number,default:function(){return 50}},disabled:{type:Boolean,default:function(){return!1}}},data:function(){return{input:""}},computed:{itemPicStyle:function(){return"height:".concat(this.height,"px;width:").concat(this.width,"px;")},previewSrcList:function(){return Array.isArray(this.fileList)?this.fileList.map((function(t){return t.url})):[]}},watch:{},created:function(){},methods:{handleImageRemove:function(t){this.$emit("remove",t)}}}),l={class:"atp-image-list"},o=["onClick"];u.render=function(t,e,i,a,s,u){var c=(0,n.up)("CircleCloseFilled"),d=(0,n.up)("el-icon"),f=(0,n.up)("el-image");return(0,n.wg)(),(0,n.iD)("div",l,[((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(t.fileList,(function(e,i){return(0,n.wg)(),(0,n.iD)("div",{class:"atp-image-list__item mr-2",key:e.url},[(0,n._)("div",{class:"atp-image-list__delete",onClick:function(e){return t.handleImageRemove(i)}},[(0,n.Wm)(d,null,{default:(0,n.w5)((function(){return[(0,n.Wm)(c)]})),_:1})],8,o),(0,n.Wm)(f,{style:(0,r.normalizeStyle)(t.itemPicStyle),class:"atp-image-list__pic",src:e.url,"preview-src-list":t.previewSrcList,fit:"cover"},null,8,["style","src","preview-src-list"])])})),128))])};var c=(0,n.aZ)({name:"ImageUpload",extends:a.s,components:{ImageList:u},props:{title:{type:String,default:function(){return""}},required:{type:Boolean,default:function(){return!1}},placeholder:{type:String,default:function(){return""}}},data:function(){return{}},computed:{showUploadBtn:function(){return 1!==this.extras.maxLimit||this.value.length!==this.extras.maxLimit},uploadBtnStyle:function(){return"height:".concat(this.extras.height,"px;width:").concat(this.extras.width,"px;")},disabledUpload:function(){return this.extras.maxLimit>1&&this.value.length===this.extras.maxLimit}},created:function(){this.setRules(),this.setDefaultValue()},methods:{setRules:function(){if(this.rules){var t=this.title;if(this.required&&this.rules.push({required:!0,message:"".concat(t,"不能为空"),trigger:"submit"}),this.extras){var e=parseInt(this.extras.minLimit),i=parseInt(this.extras.maxLimit);isNaN(e)||isNaN(i)?isNaN(e)?isNaN(i)||this.rules.push({validator:function(t,e,n){Array.isArray(e)&&e.length>i?n(new Error("最多允许上传".concat(i,"个文件"))):n()},trigger:"submit"}):this.rules.push({validator:function(t,i,n){Array.isArray(i)&&i.length<e?n(new Error("最少需要上传".concat(e,"个文件"))):n()},trigger:"submit"}):this.rules.push({validator:function(t,n,r){Array.isArray(n)&&(n.length<e||n.length>i)?r(new Error("上传文件数量在".concat(e,"和").concat(i,"之间"))):r()},trigger:"submit"})}}},setDefaultValue:function(){this.value||this.onChange([],this.id)},beforeUpload:function(t){var e=this.__$app.config.globalProperties.$message,i=new RegExp("^[一-龥A-Za-z0-9_-]+$");if(t.name.split(".").length>2||!i.test(this.filename))return e?e({showClose:!0,message:"文件名仅能包含中文数字英文字母_-",type:"error"}):alert("文件名仅能包含中文数字英文字母_-"),!1;var n=this.extras.fileSizeLimit;if(n.value){var r="MB"===n.unit?1024*n.value:n.value;if(t.size/1024>r)return e?e({showClose:!0,message:"上传文件大小不能超过".concat(n.value).concat(n.unit),type:"error"}):alert("上传文件大小不能超过".concat(n.value).concat(n.unit)),!1}return!0},uploadSuccess:function(t,e,i){var n=this,r=function(e){var r=n.extras.uploadConfig,a=r.nameFieldPath,u=r.urlFieldPath,l=r.thumbUrlFieldPath,o=e.name;a&&(o=(0,s.g)(t,a));var c="";u&&(c=(0,s.g)(t,u));var d=c;l&&(c=(0,s.g)(t,l));var f=i.findIndex((function(t){return t.uid&&t.uid===e.uid}));i[f]={name:o,url:c,thumbUrl:d,uid:e.uid,status:e.status,percentage:e.percentage}};this.extras.actionConfig.success?this.onEvent(this.extras.actionConfig.success,{file:e,res:t,id:this.id,fieldPath:this.fieldPath},r):r(e)},uploadError:function(t,e,i){this.extras.actionConfig.success&&this.onEvent(this.extras.actionConfig.success,{file:e,err:t,id:this.id,fieldPath:this.fieldPath})},handleImageRemove:function(t){var e=this;if(Array.isArray(this.value)){var i=this.value[t];i.status="uploading";var n=function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"success";if(i.status="success","success"===n){var r=(0,s.h)(e.value);r.splice(t,1),e.onChange(r,e.id)}};this.extras.actionConfig.remove?this.onEvent(this.extras.actionConfig.remove,{file:i,id:this.id,fieldPath:this.fieldPath},n):n()}}}});c.render=function(t,e,i,a,s,u){var l=(0,n.up)("image-list"),o=(0,n.up)("Plus"),c=(0,n.up)("el-icon"),d=(0,n.up)("el-upload"),f=(0,n.up)("el-form-item");return(0,n.wg)(),(0,n.j4)(f,{label:t.title,class:(0,r.normalizeClass)([t.required?"is-required":"","atp-image-upload"]),prop:t.validProp,rules:t.rules},{default:(0,n.w5)((function(){return[t.value.length?((0,n.wg)(),(0,n.j4)(l,{key:0,width:t.extras.width,height:t.extras.height,"file-list":t.value,onRemove:t.handleImageRemove},null,8,["width","height","file-list","onRemove"])):(0,n.kq)("",!0),t.showUploadBtn?((0,n.wg)(),(0,n.j4)(d,{key:1,"file-list":t.value,"onUpdate:file-list":e[0]||(e[0]=function(e){return t.value=e}),accept:"image/*",action:t.extras.uploadConfig.action,disabled:t.disabledUpload,"show-file-list":!1,"before-upload":t.beforeUpload,"on-success":t.uploadSuccess,"on-error":t.uploadError},{default:(0,n.w5)((function(){return[(0,n._)("div",{class:(0,r.normalizeClass)(["atp-image-upload__btn",t.disabledUpload?"atp-image-upload__btn--disabled":""]),style:(0,r.normalizeStyle)(t.uploadBtnStyle)},[(0,n.Wm)(c,null,{default:(0,n.w5)((function(){return[(0,n.Wm)(o)]})),_:1})],6)]})),_:1},8,["file-list","action","disabled","before-upload","on-success","on-error"])):(0,n.kq)("",!0)]})),_:1},8,["label","class","prop","rules"])}}}]);